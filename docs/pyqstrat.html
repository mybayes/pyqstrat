<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>pyqstrat package &#8212; pyqstrat 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="pyqstrat" href="modules.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pyqstrat-package">
<h1>pyqstrat package<a class="headerlink" href="#pyqstrat-package" title="Link to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-pyqstrat.pq_utils">
<span id="pyqstrat-pq-utils-module"></span><h2>pyqstrat.pq_utils module<a class="headerlink" href="#module-pyqstrat.pq_utils" title="Link to this heading">¶</a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.PQException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">PQException</span></span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#PQException"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.PQException" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.Paths">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">Paths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#Paths"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.Paths" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Conventions for where to read / write data and reports</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.Paths.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#Paths.create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.Paths.create" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.assert_">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">assert_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#assert_"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.assert_" title="Link to this definition">¶</a></dt>
<dd><p>Like a python assert but raises an exception that is not turned off by
using the python optimization switch</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.bootstrap_ci">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">bootstrap_ci</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ci_level=0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n=1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func=&lt;function</span> <span class="pre">mean&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#bootstrap_ci"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.bootstrap_ci" title="Link to this definition">¶</a></dt>
<dd><p>Non parametric bootstrap for confidence intervals
:type a: <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>
:param a: The data to bootstrap from
:type ci_level: <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>
:param ci_level: The confidence interval level, e.g. 0.95 for 95%.  Default 0.95
:type n: <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>
:param n: Number of boostrap iterations. Default 1000
:type func: <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]
:param func: The function to use, e.g np.mean or np.median. Default np.mean</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the lower and upper ci</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">bootstrap_ci</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.9773159</span><span class="p">,</span> <span class="mf">5.010328</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.day_of_week_num">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">day_of_week_num</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#day_of_week_num"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.day_of_week_num" title="Link to this definition">¶</a></dt>
<dd><p>From <a class="reference external" href="https://stackoverflow.com/questions/52398383/finding-day-of-the-week-for-a-datetime64">https://stackoverflow.com/questions/52398383/finding-day-of-the-week-for-a-datetime64</a>
Get day of week for a numpy array of datetimes
Monday is 0, Sunday is 6</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>a</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – numpy datetime64 or array of datetime64</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Monday is 0, Sunday is 6</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or numpy ndarray of int</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">day_of_week_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2015-01-04&#39;</span><span class="p">))</span>
<span class="go">6</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.day_symbol">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">day_symbol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">day_int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#day_symbol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.day_symbol" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.find_in_subdir">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">find_in_subdir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#find_in_subdir"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.find_in_subdir" title="Link to this definition">¶</a></dt>
<dd><p>Find relative path of a file in a subdirectory</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.get_child_logger">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">get_child_logger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">child_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#get_child_logger"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.get_child_logger" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Logger</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.get_config">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">get_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#get_config"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.get_config" title="Link to this definition">¶</a></dt>
<dd><p>Load config data from yaml file and returns it as a dict.
This first loads values from a config file called pyqstrat.yml in
your home directory. Next it looks for a file called pyqstrat.yml in your local working directory.
If found, it overrides any values in the config data from any data it finds in this file.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.get_empty_np_value">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">get_empty_np_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">np_dtype</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#get_empty_np_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.get_empty_np_value" title="Link to this definition">¶</a></dt>
<dd><p>Get empty value for a given numpy datatype
&gt;&gt;&gt; a = np.array([‘2018-01-01’, ‘2018-01-03’], dtype = ‘M8[D]’)
&gt;&gt;&gt; get_empty_np_value(a.dtype)
numpy.datetime64(‘NaT’)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.get_main_logger">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">get_main_logger</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#get_main_logger"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.get_main_logger" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Logger</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.get_paths">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">get_paths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#get_paths"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.get_paths" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.pq_utils.Paths" title="pyqstrat.pq_utils.Paths"><code class="xref py py-class docutils literal notranslate"><span class="pre">Paths</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.get_temp_dir">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">get_temp_dir</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#get_temp_dir"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.get_temp_dir" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.has_display">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">has_display</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#has_display"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.has_display" title="Link to this definition">¶</a></dt>
<dd><p>Useful for running on a headless machine such as a remote server
so we don’t try to show graphs etc during unit tests</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.in_debug">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">in_debug</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#in_debug"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.in_debug" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.in_ipython">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">in_ipython</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#in_ipython"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.in_ipython" title="Link to this definition">¶</a></dt>
<dd><p>Whether we are running in an ipython (or Jupyter) environment</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.infer_compression">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">infer_compression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#infer_compression"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.infer_compression" title="Link to this definition">¶</a></dt>
<dd><p>Infers compression for a file from its suffix.  For example, given “/tmp/hello.gz”, this will return “gzip”
&gt;&gt;&gt; infer_compression(“/tmp/hello.gz”)
‘gzip’
&gt;&gt;&gt; infer_compression(“/tmp/abc.txt”) is None
True</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.infer_frequency">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">infer_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#infer_frequency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.infer_frequency" title="Link to this definition">¶</a></dt>
<dd><p>Returns most common frequency of date differences as a fraction of days
:type timestamps: <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>
:param timestamps: A numpy array of monotonically increasing datetime64</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-01 11:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:15&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:35&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[ns]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">infer_frequency</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span>  
<span class="gt">Traceback (most recent call last):</span>
<span class="w"> </span><span class="c">...</span>
<span class="gr">PQException</span>: <span class="n">could not infer frequency from timestamps...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-01 11:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:15&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:30&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:35&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 11:50&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[ns]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">infer_frequency</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="mi">8</span><span class="p">))</span>
<span class="go">0.01041667</span>
<span class="go">:rtype: :py:class:`float`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-09-01&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[D]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">infer_frequency</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.is_newer">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">is_newer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#is_newer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.is_newer" title="Link to this definition">¶</a></dt>
<dd><p>whether filename ctime (modfication time) is newer than ref_filename or either file does not exist
&gt;&gt;&gt; import time
&gt;&gt;&gt; import tempfile
&gt;&gt;&gt; temp_dir = tempfile.gettempdir()
&gt;&gt;&gt; touch(f’{temp_dir}/x.txt’)
&gt;&gt;&gt; time.sleep(0.1)
&gt;&gt;&gt; touch(f’{temp_dir}/y.txt’)
&gt;&gt;&gt; is_newer(f’{temp_dir}/y.txt’, f’{temp_dir}/x.txt’)
True
&gt;&gt;&gt; touch(f’{temp_dir}/y.txt’)
&gt;&gt;&gt; time.sleep(0.1)
&gt;&gt;&gt; touch(f’{temp_dir}/x.txt’)
&gt;&gt;&gt; is_newer(f’{temp_dir}/y.txt’, f’{temp_dir}/x.txt’)
False</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.linear_interpolate">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">linear_interpolate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#linear_interpolate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.linear_interpolate" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">linear_interpolate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">)</span> <span class="o">==</span> <span class="mf">3.45</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">linear_interpolate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">linear_interpolate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">linear_interpolate</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]),</span>
<span class="gp">... </span>   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]),</span>
<span class="gp">... </span>   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">]),</span>
<span class="gp">... </span>   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mf">8.</span><span class="p">]),</span>
<span class="go">:rtype: :py:class:`~numpy.ndarray` | :py:class:`float`</span>
</pre></div>
</div>
<p>…    np.array([8.9, 8.]))
&gt;&gt;&gt; assert(np.allclose(x, np.array([3.45, 3.])))</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.millis_since_epoch">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">millis_since_epoch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#millis_since_epoch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.millis_since_epoch" title="Link to this definition">¶</a></dt>
<dd><p>Given a python datetime, return number of milliseconds between the unix epoch and the datetime.
Returns a float since it can contain fractions of milliseconds as well
&gt;&gt;&gt; millis_since_epoch(datetime.datetime(2018, 1, 1))
1514764800000.0</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.monotonically_increasing">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">monotonically_increasing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#monotonically_increasing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.monotonically_increasing" title="Link to this definition">¶</a></dt>
<dd><p>Returns True if the array is monotonically_increasing, False otherwise</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">monotonically_increasing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[D]&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="go">:rtype: :py:class:`bool`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">monotonically_increasing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[D]&#39;</span><span class="p">))</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.nan_to_zero">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">nan_to_zero</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#nan_to_zero"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.nan_to_zero" title="Link to this definition">¶</a></dt>
<dd><p>Converts any nans in a numpy float array to 0</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_bucket">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_bucket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mid'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_bucket"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_bucket" title="Link to this definition">¶</a></dt>
<dd><p>Given a numpy array and a sorted list of buckets, assign each element to a bucket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>np.ndarray</em>) – The numpy array of values</p></li>
<li><p><strong>buckets</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – (list) List of buckets</p></li>
<li><p><strong>default_value</strong> – Used when we cannot assign an element to any bucket if side is ‘left’ or ‘right’</p></li>
<li><p><strong>side</strong> (<em>str</em>) – If set to mid, we use the midpoint between buckets to assign elements
‘left’, assignment &lt;= element
‘right’, assignment &gt;= element
Default: ‘mid’</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray of same length as a</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">buckets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np_bucket</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">buckets</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">4</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np_bucket</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">buckets</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>  <span class="mi">4</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np_bucket</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">buckets</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>  <span class="mi">4</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_find_closest">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_find_closest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_find_closest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_find_closest" title="Link to this definition">¶</a></dt>
<dd><p>From <a class="reference external" href="https://stackoverflow.com/questions/8914491/finding-the-nearest-value-and-return-the-index-of-array-in-python">https://stackoverflow.com/questions/8914491/finding-the-nearest-value-and-return-the-index-of-array-in-python</a>
Find index of closest value to array v in array a.  Returns an array of the same size as v
a must be sorted
&gt;&gt;&gt; assert(all(np_find_closest(np.array([3, 4, 6]), np.array([4, 2])) == np.array([1, 0])))</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_inc_dates">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_inc_dates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_days</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_inc_dates"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_inc_dates" title="Link to this definition">¶</a></dt>
<dd><p>Increment the given date array so each cell gets the next higher value in this array
&gt;&gt;&gt; dates = np.array([‘2021-06-01’, ‘2021-06-01’, ‘2021-08-01’, ‘2021-04-01’], dtype=’M8[D]’)
&gt;&gt;&gt; check = np.array([dates[2], dates[2], np.datetime64(‘nat’), dates[0]])
&gt;&gt;&gt; assert np.array_equal(np_inc_dates(dates, 1),
…    np.array([‘2021-08-01’, ‘2021-08-01’, ‘NaT’, ‘2021-06-01’], dtype=’M8[D]’), equal_nan=True)
&gt;&gt;&gt; assert np.array_equal(np_inc_dates(dates, 2),
…    np.array([‘NaT’, ‘NaT’, ‘NaT’, ‘2021-08-01’], dtype=’M8[D]’), equal_nan=True)
&gt;&gt;&gt; assert np.array_equal(np_inc_dates(dates, -1),
…    np.array([‘2021-04-01’, ‘2021-04-01’, ‘2021-06-01’, ‘NaT’], dtype=’M8[D]’), equal_nan=True)
&gt;&gt;&gt; assert np.array_equal(np_inc_dates(dates, -2),
…    np.array([‘NaT’, ‘NaT’, ‘2021-04-01’, ‘NaT’], dtype=’M8[D]’), equal_nan=True)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_indexof">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_indexof</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_indexof"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_indexof" title="Link to this definition">¶</a></dt>
<dd><p>Get index of a value in a numpy array.  Returns -1 if the value does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_indexof_sorted">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_indexof_sorted</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_indexof_sorted"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_indexof_sorted" title="Link to this definition">¶</a></dt>
<dd><p>Get index of a value in a sorted numpy array.  Returns -1 if the value does not exist
a = np.array([1, 2, 3, 4])
assert(np_indexof_sorted(a, 3) == 2)
assert(np.indexof_sorted(a, 8) == -1)
assert(np.indexof_sorted(a, 0) == -1)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_parse_array">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_parse_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype=&lt;class</span> <span class="pre">'float'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_parse_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_parse_array" title="Link to this definition">¶</a></dt>
<dd><p>Create a 1 or 2 d numpy array from a string that looks like:
[[2. 5. 3. 0. 0.]
[3. 5. 0. 4. 3.]]
or
[2. 5. 3. 0. 8.]</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np_parse_array</span><span class="p">(</span><span class="s1">&#39;[[2. 5. 3. 0. 0.]</span><span class="se">\n</span><span class="s1"> [3. 5. 0. 4. 3.]]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]]))</span>
<span class="go">:rtype: :py:class:`~numpy.ndarray`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np_parse_array</span><span class="p">(</span><span class="s1">&#39;[3 4. 5]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_rolling_window">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_rolling_window</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_rolling_window"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_rolling_window" title="Link to this definition">¶</a></dt>
<dd><p>For applying rolling window functions to a numpy array
See: <a class="reference external" href="https://stackoverflow.com/questions/6811183/rolling-window-for-1d-arrays-in-numpy">https://stackoverflow.com/questions/6811183/rolling-window-for-1d-arrays-in-numpy</a>
&gt;&gt;&gt; print(np.std(np_rolling_window(np.array([1, 2, 3, 4]), 2), 1))
[0.5 0.5 0.5]</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_round">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_round</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_round"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_round" title="Link to this definition">¶</a></dt>
<dd><p>Round all elements in an array to the nearest clip</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – array with elements to round</p></li>
<li><p><strong>clip</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – rounding value</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np_round</span><span class="p">(</span><span class="mf">15.8</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="go">15.75</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.np_uniques">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">np_uniques</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arrays</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#np_uniques"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.np_uniques" title="Link to this definition">¶</a></dt>
<dd><p>Given a list of numpy arrays that may have different datatype, generate a structured numpy
array with sorted, unique elements from that list
&gt;&gt;&gt; array1 = np.array([‘2018-01-02’, ‘2018-01-03’, ‘2018-01-02’, ‘2018-01-03’], dtype=’M8[D]’)
&gt;&gt;&gt; array2 = np.array([‘P’, ‘P’, ‘P’, ‘C’])
&gt;&gt;&gt; x = np_uniques([array1, array2])
&gt;&gt;&gt; assert len(x) == 3
&gt;&gt;&gt; assert x[0][0] == np.datetime64(‘2018-01-02’)
&gt;&gt;&gt; assert x[0][1] ==  ‘P’</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.percentile_of_score">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">percentile_of_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#percentile_of_score"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.percentile_of_score" title="Link to this definition">¶</a></dt>
<dd><p>For each element in a, find the percentile of a its in.  From stackoverflow.com/a/29989971/5351549
Like scipy.stats.percentileofscore but runs in O(n log(n)) time.
&gt;&gt;&gt; a = np.array([4, 3, 1, 2, 4.1])
&gt;&gt;&gt; percentiles = percentile_of_score(a)
&gt;&gt;&gt; assert(all(np.isclose(np.array([ 75.,  50.,   0.,  25., 100.]), percentiles)))</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.remove_dups">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">remove_dups</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#remove_dups"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.remove_dups" title="Link to this definition">¶</a></dt>
<dd><p>Remove duplicates from a list
:type lst: <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]
:param lst: list to remove duplicates from
:type key_func: <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]
:param key_func: A function that takes a list element and converts it to a key for detecting dups</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list with duplicates removed.  This is stable in the sense that original list elements will retain their order</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">remove_dups</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]))</span>
<span class="go">[&#39;a&#39;, &#39;d&#39;, &#39;c&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">remove_dups</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]))</span>
<span class="go">[&#39;a&#39;, &#39;d&#39;, &#39;A&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">remove_dups</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">key_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
<span class="go">[&#39;a&#39;, &#39;d&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.resample_trade_bars">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">resample_trade_bars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resample_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#resample_trade_bars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.resample_trade_bars" title="Link to this definition">¶</a></dt>
<dd><p>Downsample trade bars using sampling frequency</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – Must contain an index of numpy datetime64 type which is monotonically increasing
sampling_frequency (str): See pandas frequency strings</p></li>
<li><p><strong>str</strong> (<em>resample_funcs</em><em> (</em><em>dict of</em>) – int): a dictionary of column name -&gt; resampling function for any columns that are custom defined.  Default None.
If there is no entry for a custom column, defaults to ‘last’ for that column</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Resampled dataframe</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-08 15:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-09 13:30:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-09 15:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-11 15:00:00&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;M8[ns]&#39;</span><span class="p">),</span>
<span class="gp">... </span>         <span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.9</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">]),</span>
<span class="gp">... </span>         <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">9.4</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">]),</span>
<span class="gp">... </span>         <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.8</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">8.4</span><span class="p">]),</span>
<span class="gp">... </span>         <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.95</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">9.35</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">]),</span>
<span class="gp">... </span>         <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">300</span><span class="p">]),</span>
<span class="gp">... </span>         <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>
<span class="gp">... </span>        <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;vwap&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">l</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">resample_trade_bars</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">resample_funcs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span>
<span class="gp">... </span>  <span class="n">sampling_frequency</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">sampling_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">vwap</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">9.24</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">vwap</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mf">8.4</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.resample_ts">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">resample_ts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#resample_ts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.resample_ts" title="Link to this definition">¶</a></dt>
<dd><p>Downsample a tuple of datetimes and value arrays using sampling frequency, using the last value if it does not exist at the bin edge.
See pandas.Series.resample</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dates</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy datetime64 array</p></li>
<li><p><strong>values</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy array</p></li>
<li><p><strong>sampling_frequency</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – See pandas frequency strings</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Resampled tuple of datetime and value arrays</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.resample_vwap">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">resample_vwap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#resample_vwap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.resample_vwap" title="Link to this definition">¶</a></dt>
<dd><p>Compute weighted average of vwap given higher frequency vwap and volume</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.series_to_array">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">series_to_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#series_to_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.series_to_array" title="Link to this definition">¶</a></dt>
<dd><p>Convert a pandas series to a numpy array.  If the object is not a pandas Series return it back unchanged</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.set_defaults">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">set_defaults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_float_sf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_display_max_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_display_max_columns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">99</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">np_seterr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raise'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#set_defaults"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.set_defaults" title="Link to this definition">¶</a></dt>
<dd><p>Set some display defaults to make it easier to view dataframes and graphs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df_float_sf</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of significant figures to show in dataframes (default 4). Set to None to use pandas defaults</p></li>
<li><p><strong>df_display_max_rows</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of rows to display for pandas dataframes when you print them (default 200).  Set to None to use pandas defaults</p></li>
<li><p><strong>df_display_max_columns</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of columns to display for pandas dataframes when you print them (default 99).  Set to None to use pandas defaults</p></li>
<li><p><strong>np_seterr</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Error mode for numpy warnings.  See numpy seterr function for details.  Set to None to use numpy defaults</p></li>
<li><p><strong>jupyter_multiple_display</strong> – If set, and you have multiple outputs in a Jupyter cell, output will contain all of them. Default True</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.set_ipython_defaults">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">set_ipython_defaults</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jupyter_multiple_display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#set_ipython_defaults"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.set_ipython_defaults" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.shift_np">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">shift_np</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#shift_np"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.shift_np" title="Link to this definition">¶</a></dt>
<dd><p>Similar to pandas.Series.shift but works on numpy arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – The numpy array to shift</p></li>
<li><p><strong>n</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of places to shift, can be positive or negative</p></li>
<li><p><strong>fill_value</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – After shifting, there will be empty slots left in the array.  If set, fill these with fill_value.
If fill_value is set to None (default), we will fill these with False for boolean arrays, np.nan for floats</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.str2date">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">str2date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#str2date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.str2date" title="Link to this definition">¶</a></dt>
<dd><p>Converts a string like “2008-01-15 15:00:00” to a numpy datetime64.  If s is not a string, return s back</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.strtup2date">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">strtup2date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tup</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#strtup2date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.strtup2date" title="Link to this definition">¶</a></dt>
<dd><p>Converts a string tuple like (“2008-01-15”, “2009-01-16”) to a numpy datetime64 tuple.
If the tuple does not contain strings, return it back unchanged</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.to_csv">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">to_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#to_csv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.to_csv" title="Link to this definition">¶</a></dt>
<dd><p>Creates a temporary file then renames to the permanent file so we don’t have half written files.
Also optionally compresses using the xz algorithm</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.touch">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">touch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">438</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_fd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#touch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.touch" title="Link to this definition">¶</a></dt>
<dd><p>replicate unix touch command, i.e create file if it doesn’t exist, otherwise update timestamp</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.try_frequency">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">try_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">period</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#try_frequency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.try_frequency" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_utils.zero_to_nan">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_utils.</span></span><span class="sig-name descname"><span class="pre">zero_to_nan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_utils.html#zero_to_nan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_utils.zero_to_nan" title="Link to this definition">¶</a></dt>
<dd><p>Converts any zeros in a numpy array to nans</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat.pq_types">
<span id="pyqstrat-pq-types-module"></span><h2>pyqstrat.pq_types module<a class="headerlink" href="#module-pyqstrat.pq_types" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">Contract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiry</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiplier</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.clear_cache">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">clear_cache</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract.clear_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract.clear_cache" title="Link to this definition">¶</a></dt>
<dd><p>Remove our cache of contract groups</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.components">
<span class="sig-name descname"><span class="pre">components</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.pq_types.Contract.components" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.contract_group">
<span class="sig-name descname"><span class="pre">contract_group</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a></em><a class="headerlink" href="#pyqstrat.pq_types.Contract.contract_group" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.create">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiry</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiplier</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract.create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract.create" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbol</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – A unique string reprenting this contract. e.g IBM or ESH9</p></li>
<li><p><strong>contract_group</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – We sometimes need to group contracts for calculating PNL, for example, you may have a strategy
which has options and a future or equity used to hedge delta.  In this case, you will be trading
different symbols over time as options and futures expire, but you may want to track PNL for each leg using
a contract group for each leg. So you could create contract groups ‘OPTIONS’ and one for ‘HEDGES’</p></li>
<li><p><strong>expiry</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>]) – In the case of a future or option, the date and time when the
contract expires.  For equities and other non expiring contracts, set this to None.  Default None.</p></li>
<li><p><strong>multiplier</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – If the market price convention is per unit, and the unit is not the same as contract size,
set the multiplier here. For example, for E-mini contracts, each contract is 50 units and the price is per unit,
so multiplier would be 50.  Default 1</p></li>
<li><p><strong>properties</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>]) – Any data you want to store with this contract.
For example, you may want to store option strike.  Default None</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.exists">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract.exists"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract.exists" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.expiry">
<span class="sig-name descname"><span class="pre">expiry</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.pq_types.Contract.expiry" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.get">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract.get"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract.get" title="Link to this definition">¶</a></dt>
<dd><p>Returns an existing contrat or none if it does not exist</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.get_or_create">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_or_create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiry</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiplier</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract.get_or_create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract.get_or_create" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.is_basket">
<span class="sig-name descname"><span class="pre">is_basket</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Contract.is_basket"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Contract.is_basket" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.multiplier">
<span class="sig-name descname"><span class="pre">multiplier</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Contract.multiplier" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.properties">
<span class="sig-name descname"><span class="pre">properties</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Contract.properties" title="Link to this definition">¶</a></dt>
<dd><p>A contract such as a stock, option or a future that can be traded</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Contract.symbol">
<span class="sig-name descname"><span class="pre">symbol</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Contract.symbol" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">ContractGroup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A way to group contracts for figuring out which indicators, rules and signals to apply to a contract and for PNL reporting</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.add_contract">
<span class="sig-name descname"><span class="pre">add_contract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.add_contract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.add_contract" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.clear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.clear" title="Link to this definition">¶</a></dt>
<dd><p>Remove all contracts</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.clear_cache">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">clear_cache</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.clear_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.clear_cache" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.contracts">
<span class="sig-name descname"><span class="pre">contracts</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.contracts" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.exists">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.exists"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.exists" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.get">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.get"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.get" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a></p>
</dd>
</dl>
<dl class="simple">
<dt>Create a contract group if it does not exist, or returns an existing one</dt><dd><dl class="simple">
<dt>Args:</dt><dd><p>name: Name of the group</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.get_contract">
<span class="sig-name descname"><span class="pre">get_contract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.get_contract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.get_contract" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.get_contracts">
<span class="sig-name descname"><span class="pre">get_contracts</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.get_contracts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.get_contracts" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.get_default">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_default</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#ContractGroup.get_default"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.get_default" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.ContractGroup.name">
<span class="sig-name descname"><span class="pre">name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.ContractGroup.name" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.LimitOrder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">LimitOrder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp=numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code=''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_in_force=TimeInForce.FOK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status=OrderStatus.OPEN</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_price</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#LimitOrder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.LimitOrder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.LimitOrder.limit_price">
<span class="sig-name descname"><span class="pre">limit_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.LimitOrder.limit_price" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.MarketOrder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">MarketOrder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp=numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code=''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_in_force=TimeInForce.FOK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status=OrderStatus.OPEN</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#MarketOrder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.MarketOrder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">Order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp=numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code=''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_in_force=TimeInForce.FOK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status=OrderStatus.OPEN</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Order" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract</strong> (<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>) – The contract this order is for</p></li>
<li><p><strong>timestamp</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Time the order was placed</p></li>
<li><p><strong>qty</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Number of contracts or shares.  Use a negative quantity for sell orders</p></li>
<li><p><strong>reason_code</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The reason this order was created. Default ‘’</p></li>
<li><p><strong>properties</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>) – Any order specific data we want to store.  Default None</p></li>
<li><p><strong>status</strong> (<a class="reference internal" href="#pyqstrat.pq_types.OrderStatus" title="pyqstrat.pq_types.OrderStatus"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrderStatus</span></code></a>) – Status of the order, “open”, “filled”, etc. Default “open”</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.cancel">
<span class="sig-name descname"><span class="pre">cancel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Order.cancel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Order.cancel" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.contract">
<span class="sig-name descname"><span class="pre">contract</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a></em><a class="headerlink" href="#pyqstrat.pq_types.Order.contract" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.fill">
<span class="sig-name descname"><span class="pre">fill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fill_qty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Order.fill"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Order.fill" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.is_open">
<span class="sig-name descname"><span class="pre">is_open</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Order.is_open"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Order.is_open" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.properties">
<span class="sig-name descname"><span class="pre">properties</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Order.properties" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.qty">
<span class="sig-name descname"><span class="pre">qty</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">nan</span></em><a class="headerlink" href="#pyqstrat.pq_types.Order.qty" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">''</span></em><a class="headerlink" href="#pyqstrat.pq_types.Order.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.request_cancel">
<span class="sig-name descname"><span class="pre">request_cancel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Order.request_cancel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Order.request_cancel" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.status">
<span class="sig-name descname"><span class="pre">status</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#pyqstrat.pq_types.OrderStatus" title="pyqstrat.pq_types.OrderStatus"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrderStatus</span></code></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#pyqstrat.pq_types.Order.status" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.time_in_force">
<span class="sig-name descname"><span class="pre">time_in_force</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#pyqstrat.pq_types.TimeInForce" title="pyqstrat.pq_types.TimeInForce"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeInForce</span></code></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#pyqstrat.pq_types.Order.time_in_force" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Order.timestamp">
<span class="sig-name descname"><span class="pre">timestamp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">numpy.datetime64('NaT')</span></em><a class="headerlink" href="#pyqstrat.pq_types.Order.timestamp" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.OrderStatus">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">OrderStatus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#OrderStatus"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.OrderStatus" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Enum for order status</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.OrderStatus.CANCELLED">
<span class="sig-name descname"><span class="pre">CANCELLED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">5</span></em><a class="headerlink" href="#pyqstrat.pq_types.OrderStatus.CANCELLED" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.OrderStatus.CANCEL_REQUESTED">
<span class="sig-name descname"><span class="pre">CANCEL_REQUESTED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4</span></em><a class="headerlink" href="#pyqstrat.pq_types.OrderStatus.CANCEL_REQUESTED" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.OrderStatus.FILLED">
<span class="sig-name descname"><span class="pre">FILLED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#pyqstrat.pq_types.OrderStatus.FILLED" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.OrderStatus.OPEN">
<span class="sig-name descname"><span class="pre">OPEN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#pyqstrat.pq_types.OrderStatus.OPEN" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.OrderStatus.PARTIALLY_FILLED">
<span class="sig-name descname"><span class="pre">PARTIALLY_FILLED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#pyqstrat.pq_types.OrderStatus.PARTIALLY_FILLED" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">Price</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bid_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ask_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Price"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Price" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">price</span> <span class="o">=</span> <span class="n">Price</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">15.25</span><span class="p">,</span> <span class="mf">15.75</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="go">15.25@189/15.75@300</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">price</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">price</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="go">15.25@189/15.75@300 delta: -0.3 invalid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">mid</span><span class="p">())</span>
<span class="go">15.5</span>
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.ask">
<span class="sig-name descname"><span class="pre">ask</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Price.ask" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.ask_size">
<span class="sig-name descname"><span class="pre">ask_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Price.ask_size" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.bid">
<span class="sig-name descname"><span class="pre">bid</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Price.bid" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.bid_size">
<span class="sig-name descname"><span class="pre">bid_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Price.bid_size" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.invalid">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">invalid</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Price.invalid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Price.invalid" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.pq_types.Price" title="pyqstrat.pq_types.Price"><code class="xref py py-class docutils literal notranslate"><span class="pre">Price</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.mid">
<span class="sig-name descname"><span class="pre">mid</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Price.mid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Price.mid" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.properties">
<span class="sig-name descname"><span class="pre">properties</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#pyqstrat.pq_types.Price.properties" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.set_property">
<span class="sig-name descname"><span class="pre">set_property</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Price.set_property"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Price.set_property" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.spread">
<span class="sig-name descname"><span class="pre">spread</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Price.spread"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Price.spread" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.timestamp">
<span class="sig-name descname"><span class="pre">timestamp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.Price.timestamp" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.valid">
<span class="sig-name descname"><span class="pre">valid</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#pyqstrat.pq_types.Price.valid" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Price.vw_mid">
<span class="sig-name descname"><span class="pre">vw_mid</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Price.vw_mid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Price.vw_mid" title="Link to this definition">¶</a></dt>
<dd><p>Volume weighted mid
&gt;&gt;&gt; price = Price(datetime.datetime(2020, 1, 1), 15.25, 15.75, 189, 300)
&gt;&gt;&gt; print(f’{price.vw_mid():.4f}’)
15.4433
&gt;&gt;&gt; price.bid_size = 0
&gt;&gt;&gt; price.ask_size = 0
&gt;&gt;&gt; assert math.isnan(price.vw_mid())</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RollOrder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">RollOrder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp=numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code=''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_in_force=TimeInForce.FOK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status=OrderStatus.OPEN</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_qty</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reopen_qty</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#RollOrder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.RollOrder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RollOrder.close_qty">
<span class="sig-name descname"><span class="pre">close_qty</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RollOrder.close_qty" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RollOrder.reopen_qty">
<span class="sig-name descname"><span class="pre">reopen_qty</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RollOrder.reopen_qty" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">RoundTripTrade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exit_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exit_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry_price</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exit_price</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry_reason</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exit_reason</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry_commission</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exit_commission</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry_properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exit_properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">net_pnl=nan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#RoundTripTrade"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.contract">
<span class="sig-name descname"><span class="pre">contract</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.contract" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.entry_commission">
<span class="sig-name descname"><span class="pre">entry_commission</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.entry_commission" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.entry_order">
<span class="sig-name descname"><span class="pre">entry_order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.entry_order" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.entry_price">
<span class="sig-name descname"><span class="pre">entry_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.entry_price" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.entry_properties">
<span class="sig-name descname"><span class="pre">entry_properties</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.entry_properties" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.entry_reason">
<span class="sig-name descname"><span class="pre">entry_reason</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.entry_reason" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.entry_timestamp">
<span class="sig-name descname"><span class="pre">entry_timestamp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.entry_timestamp" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.exit_commission">
<span class="sig-name descname"><span class="pre">exit_commission</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.exit_commission" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.exit_order">
<span class="sig-name descname"><span class="pre">exit_order</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.exit_order" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.exit_price">
<span class="sig-name descname"><span class="pre">exit_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.exit_price" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.exit_properties">
<span class="sig-name descname"><span class="pre">exit_properties</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.exit_properties" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.exit_reason">
<span class="sig-name descname"><span class="pre">exit_reason</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.exit_reason" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.exit_timestamp">
<span class="sig-name descname"><span class="pre">exit_timestamp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.exit_timestamp" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.net_pnl">
<span class="sig-name descname"><span class="pre">net_pnl</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">nan</span></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.net_pnl" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.RoundTripTrade.qty">
<span class="sig-name descname"><span class="pre">qty</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.RoundTripTrade.qty" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.StopLimitOrder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">StopLimitOrder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp=numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code=''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_in_force=TimeInForce.FOK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status=OrderStatus.OPEN</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_price</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_price=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">triggered=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#StopLimitOrder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.StopLimitOrder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a></p>
<dl class="simple">
<dt>Used for stop loss or stop limit orders.  The order is triggered when price goes above or below trigger price, depending on whether this is a short</dt><dd><p>or long order.  Becomes either a market or limit order at that point, depending on whether you set the limit price or not.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trigger_price</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Order becomes a market or limit order if price crosses trigger_price.</p></li>
<li><p><strong>limit_price</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – If not set (default), order becomes a market order when price crosses trigger price.
Otherwise it becomes a limit order.  Default np.nan</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.StopLimitOrder.limit_price">
<span class="sig-name descname"><span class="pre">limit_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">nan</span></em><a class="headerlink" href="#pyqstrat.pq_types.StopLimitOrder.limit_price" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.StopLimitOrder.trigger_price">
<span class="sig-name descname"><span class="pre">trigger_price</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.StopLimitOrder.trigger_price" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.StopLimitOrder.triggered">
<span class="sig-name descname"><span class="pre">triggered</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#pyqstrat.pq_types.StopLimitOrder.triggered" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.TimeInForce">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">TimeInForce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#TimeInForce"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.TimeInForce" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>An enumeration.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.TimeInForce.DAY">
<span class="sig-name descname"><span class="pre">DAY</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#pyqstrat.pq_types.TimeInForce.DAY" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.TimeInForce.FOK">
<span class="sig-name descname"><span class="pre">FOK</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#pyqstrat.pq_types.TimeInForce.FOK" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.TimeInForce.GTC">
<span class="sig-name descname"><span class="pre">GTC</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#pyqstrat.pq_types.TimeInForce.GTC" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Trade">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">Trade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fee</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commission</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Trade"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Trade" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.pq_types.Trade.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fee</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commission</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#Trade.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.Trade.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract</strong> (<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>) – The contract we traded</p></li>
<li><p><strong>order</strong> (<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>) – A reference to the order that created this trade. Default None</p></li>
<li><p><strong>timestamp</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Trade execution datetime</p></li>
<li><p><strong>qty</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Number of contracts or shares filled</p></li>
<li><p><strong>price</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Trade price</p></li>
<li><p><strong>fee</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Fees paid to brokers or others. Default 0</p></li>
<li><p><strong>commision</strong> – Commission paid to brokers or others. Default 0</p></li>
<li><p><strong>properties</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>]) – Any data you want to store with this contract.
For example, you may want to store bid / ask prices at time of trade.  Default None</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.pq_types.VWAPOrder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_types.</span></span><span class="sig-name descname"><span class="pre">VWAPOrder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp=numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qty=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code=''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_in_force=TimeInForce.FOK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status=OrderStatus.OPEN</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vwap_stop=nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vwap_end_time</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_types.html#VWAPOrder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_types.VWAPOrder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a></p>
<p>An order type to trade at VWAP. A vwap order executes at VWAP from the point it is sent to the market
till the vwap end time specified in the order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vwap_stop</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – limit price. If market price &lt;= vwap_stop for buys or market price</p></li>
<li><p><strong>sells</strong> (<em>&gt;= vwap_stop for</em>) – </p></li>
<li><p><strong>point.</strong> (<em>the order is executed at that</em>) – </p></li>
<li><p><strong>vwap_end_time</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – We want to execute at VWAP computed from now to this time</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.VWAPOrder.vwap_end_time">
<span class="sig-name descname"><span class="pre">vwap_end_time</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></em><a class="headerlink" href="#pyqstrat.pq_types.VWAPOrder.vwap_end_time" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.pq_types.VWAPOrder.vwap_stop">
<span class="sig-name descname"><span class="pre">vwap_stop</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">nan</span></em><a class="headerlink" href="#pyqstrat.pq_types.VWAPOrder.vwap_stop" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-pyqstrat.pq_io">
<span id="pyqstrat-pq-io-module"></span><h2>pyqstrat.pq_io module<a class="headerlink" href="#module-pyqstrat.pq_io" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.df_to_hdf5">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">df_to_hdf5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_utf8</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#df_to_hdf5"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.df_to_hdf5" title="Link to this definition">¶</a></dt>
<dd><p>Write out a pandas dataframe to hdf5 using the np_arrays_to_hdf5 function</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.hdf5_copy">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">hdf5_copy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_if_exists</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#hdf5_copy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.hdf5_copy" title="Link to this definition">¶</a></dt>
<dd><p>Recursively copy groups from input filename to output filename.
:type skip_if_exists: <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>
:param skip_if_exists: if set, we will skip any groups in the output that already exist.
:param Otherwise we replace them.:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tempdir</span> <span class="o">=</span> <span class="n">get_temp_dir</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">in_filename</span> <span class="o">=</span> <span class="n">tempdir</span> <span class="o">+</span> <span class="s1">&#39;/temp_in.hdf5&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out_filename</span> <span class="o">=</span> <span class="n">tempdir</span> <span class="o">+</span> <span class="s1">&#39;/temp_out.hdf5&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="n">in_filename</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">]:</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;test_g/test_subg&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">in_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">... </span>   <span class="n">ds</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdf5_copy</span><span class="p">(</span><span class="n">in_filename</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">assert_</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdf5_copy</span><span class="p">(</span><span class="n">in_filename</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">assert_</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdf5_copy</span><span class="p">(</span><span class="n">in_filename</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">:rtype: :py:obj:`None`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">assert_</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.hdf5_repack">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">hdf5_repack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">in_filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#hdf5_repack"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.hdf5_repack" title="Link to this definition">¶</a></dt>
<dd><p>Copy groups from input filename to output filename.
Serves the same purpose as the h5repack command line tool, i.e.
discards empty space in the input file so the output file may be smaller</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.hdf5_to_df">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">hdf5_to_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#hdf5_to_df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.hdf5_to_df" title="Link to this definition">¶</a></dt>
<dd><p>Read a pandas dataframe previously written out using df_to_hdf5 or np_arrays_to_hdf5</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.hdf5_to_np_arrays">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">hdf5_to_np_arrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#hdf5_to_np_arrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.hdf5_to_np_arrays" title="Link to this definition">¶</a></dt>
<dd><p>Read a list of numpy arrays previously written out by np_arrays_to_hdf5
:type filename: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param filename: path of the hdf5 file to read
:type key: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param key: group and or / subgroups to read from.  For example, “g1/g2” will read from the subgrp g2 within the grp g1</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of numpy arrays along with their names</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.np_arrays_to_hdf5">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">np_arrays_to_hdf5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtypes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_utf8</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compression_args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#np_arrays_to_hdf5"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.np_arrays_to_hdf5" title="Link to this definition">¶</a></dt>
<dd><p>Write a list of numpy arrays to hdf5
:type data: <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]
:param data: list of numpy one dimensional arrays along with the name of the array
:type filename: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param filename: filename of the hdf5 file
:type key: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param key: group and or / subgroups to write to.  For example, “g1/g2” will write to the subgrp g2 within the grp g1
:type dtypes: <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]
:param dtypes: dict used to override datatype for a column.  For example, {“col1”: “f4”} will write a 4 byte float array for col1
:param as_utf_8: each column listed here will be saved with utf8 encoding. For all other strings, we will compute the max length
:param and store as a fixed length byte array with ascii encoding:
:param i.e. a S[max length] datatype. This is much faster to read and process:
:type compression_args: <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]
:param compression_args: if you want to compress the hdf5 file. You can use the hdf5plugin module and arguments such as hdf5plugin.Blosc()</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pq_io.test_hdf5_to_df">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pq_io.</span></span><span class="sig-name descname"><span class="pre">test_hdf5_to_df</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/pq_io.html#test_hdf5_to_df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.pq_io.test_hdf5_to_df" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyqstrat.holiday_calendars">
<span id="pyqstrat-holiday-calendars-module"></span><h2>pyqstrat.holiday_calendars module<a class="headerlink" href="#module-pyqstrat.holiday_calendars" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.holiday_calendars.</span></span><span class="sig-name descname"><span class="pre">Calendar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">calendar_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">calendar_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Create a calendar object
:type calendar_name: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param calendar_name: name of calendar as defined in the pandas_market_calendars package
:type calendar_name: str</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar.add_trading_days">
<span class="sig-name descname"><span class="pre">add_trading_days</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_days</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roll</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raise'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar.add_trading_days"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar.add_trading_days" title="Link to this definition">¶</a></dt>
<dd><p>Adds trading days to a start date</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">date</span></code>]) – start datetimes(s)</p></li>
<li><p><strong>num_days</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – number of trading days to add</p></li>
<li><p><strong>roll</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – one of ‘raise’, ‘nat’, ‘forward’, ‘following’, ‘backward’, ‘preceding’, ‘modifiedfollowing’, ‘modifiedpreceding’ or ‘allow’}
‘allow’ is a special case in which case, adding 1 day to a holiday will act as if it was not a holiday, and give you the next business day’
The rest of the values are the same as in the numpy busday_offset function
From numpy documentation:
How to treat dates that do not fall on a valid day. The default is ‘raise’.
‘raise’ means to raise an exception for an invalid day.
‘nat’ means to return a NaT (not-a-time) for an invalid day.
‘forward’ and ‘following’ mean to take the first valid day later in time.
‘backward’ and ‘preceding’ mean to take the first valid day earlier in time.
‘modifiedfollowing’ means to take the first valid day later in time unless it is across a Month boundary,
in which case to take the first valid day earlier in time.
‘modifiedpreceding’ means to take the first valid day earlier in time unless it is across a Month boundary,
in which case to take the first valid day later in time.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The datetime num_days trading days after start</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;NYSE&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">add_trading_days</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2015-12-28&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">add_trading_days</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2017-04-15&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">roll</span> <span class="o">=</span> <span class="s1">&#39;preceding&#39;</span><span class="p">)</span> <span class="c1"># 4/14/2017 is a Friday and a holiday</span>
<span class="go">numpy.datetime64(&#39;2017-04-13&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">add_trading_days</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2017-04-08&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">roll</span> <span class="o">=</span> <span class="s1">&#39;preceding&#39;</span><span class="p">)</span> <span class="c1"># 4/7/2017 is a Friday and not a holiday</span>
<span class="go">numpy.datetime64(&#39;2017-04-07&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">add_trading_days</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2019-02-17 15:25&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">roll</span> <span class="o">=</span> <span class="s1">&#39;allow&#39;</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2019-02-19T15:25&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">add_trading_days</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2019-02-17 15:25&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">roll</span> <span class="o">=</span> <span class="s1">&#39;allow&#39;</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2019-02-15T15:25&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar.get_trading_days">
<span class="sig-name descname"><span class="pre">get_trading_days</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_last</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar.get_trading_days"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar.get_trading_days" title="Link to this definition">¶</a></dt>
<dd><p>Get back a list of numpy dates that are trading days between the start and end</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;NYSE&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">get_trading_days</span><span class="p">(</span><span class="s1">&#39;2005-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2005-01-08&#39;</span><span class="p">)</span>
<span class="go">array([&#39;2005-01-03&#39;, &#39;2005-01-04&#39;, &#39;2005-01-05&#39;, &#39;2005-01-06&#39;, &#39;2005-01-07&#39;], dtype=&#39;datetime64[D]&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">get_trading_days</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">array([&#39;2005-01-03&#39;, &#39;2005-01-04&#39;, &#39;2005-01-05&#39;, &#39;2005-01-06&#39;,</span>
<span class="go">       &#39;2005-01-07&#39;, &#39;2005-01-10&#39;, &#39;2005-01-11&#39;, &#39;2005-01-12&#39;,</span>
<span class="go">       &#39;2005-01-13&#39;, &#39;2005-01-14&#39;, &#39;2005-01-18&#39;, &#39;2005-01-19&#39;,</span>
<span class="go">       &#39;2005-01-20&#39;, &#39;2005-01-21&#39;, &#39;2005-01-24&#39;, &#39;2005-01-25&#39;,</span>
<span class="go">       &#39;2005-01-26&#39;, &#39;2005-01-27&#39;, &#39;2005-01-28&#39;, &#39;2005-01-31&#39;, &#39;2005-02-01&#39;], dtype=&#39;datetime64[D]&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">get_trading_days</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span> <span class="n">include_last</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">array([&#39;2016-01-06&#39;, &#39;2016-01-07&#39;, &#39;2016-01-08&#39;, &#39;2016-01-11&#39;,</span>
<span class="go">       &#39;2016-01-12&#39;, &#39;2016-01-13&#39;, &#39;2016-01-14&#39;, &#39;2016-01-15&#39;,</span>
<span class="go">       &#39;2016-01-19&#39;, &#39;2016-01-20&#39;, &#39;2016-01-21&#39;, &#39;2016-01-22&#39;,</span>
<span class="go">       &#39;2016-01-25&#39;, &#39;2016-01-26&#39;, &#39;2016-01-27&#39;, &#39;2016-01-28&#39;], dtype=&#39;datetime64[D]&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">get_trading_days</span><span class="p">(</span><span class="s1">&#39;2017-07-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-07-08&#39;</span><span class="p">,</span> <span class="n">include_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">array([&#39;2017-07-05&#39;, &#39;2017-07-06&#39;, &#39;2017-07-07&#39;], dtype=&#39;datetime64[D]&#39;)</span>
<span class="go">:rtype: :py:class:`int` | :py:class:`~numpy.ndarray`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">get_trading_days</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2017-07-04&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2017-07-08&#39;</span><span class="p">),</span> <span class="n">include_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">array([&#39;2017-07-05&#39;, &#39;2017-07-06&#39;, &#39;2017-07-07&#39;], dtype=&#39;datetime64[D]&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar.is_trading_day">
<span class="sig-name descname"><span class="pre">is_trading_day</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dates</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar.is_trading_day"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar.is_trading_day" title="Link to this definition">¶</a></dt>
<dd><p>Returns whether the date is not a holiday or a weekend</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dates</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">date</span></code>]) – date times to check</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Whether this date is a trading day</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eurex</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;EUREX&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eurex</span><span class="o">.</span><span class="n">is_trading_day</span><span class="p">(</span><span class="s1">&#39;2016-12-25&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eurex</span><span class="o">.</span><span class="n">is_trading_day</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;NYSE&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">is_trading_day</span><span class="p">(</span><span class="s1">&#39;2017-04-01&#39;</span><span class="p">)</span> <span class="c1"># Weekend</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">is_trading_day</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="s1">&#39;2017-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-04-09&#39;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">))</span> 
<span class="go">array([False, False,  True,  True,  True,  True,  True, False]...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar.num_trading_days">
<span class="sig-name descname"><span class="pre">num_trading_days</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_last</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar.num_trading_days"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar.num_trading_days" title="Link to this definition">¶</a></dt>
<dd><p>Count the number of trading days between two date series including those two dates</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eurex</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;EUREX&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eurex</span><span class="o">.</span><span class="n">num_trading_days</span><span class="p">(</span><span class="s1">&#39;2009-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-31&#39;</span><span class="p">)</span>
<span class="go">766.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2013-01-01&#39;</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2013-01-09&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">increments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">29</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PerformanceWarning</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dates2</span> <span class="o">=</span> <span class="n">dates</span> <span class="o">+</span> <span class="n">increments</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;NaT&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dates2</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;NaT&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">dates2</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;NYSE&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;float&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">})</span>  <span class="c1"># After numpy 1.13 positive floats don&#39;t have a leading space for sign</span>
<span class="go">:rtype: :py:class:`float` | :py:class:`~numpy.ndarray`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">nyse</span><span class="o">.</span><span class="n">num_trading_days</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="go">[3.0 0.0 1.0 5.0 nan 8.0 nan 20.0]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.Calendar.third_friday_of_month">
<span class="sig-name descname"><span class="pre">third_friday_of_month</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">month</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roll</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'backward'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#Calendar.third_friday_of_month"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.Calendar.third_friday_of_month" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span> <span class="o">=</span> <span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;NYSE&#39;</span><span class="p">)</span>
<span class="go">:rtype: :py:class:`~numpy.datetime64`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nyse</span><span class="o">.</span><span class="n">third_friday_of_month</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2017</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2017-03-17&#39;)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.holiday_calendars.get_date_from_weekday">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.holiday_calendars.</span></span><span class="sig-name descname"><span class="pre">get_date_from_weekday</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weekday</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">week</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/holiday_calendars.html#get_date_from_weekday"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.holiday_calendars.get_date_from_weekday" title="Link to this definition">¶</a></dt>
<dd><p>Return the date that falls on a given weekday (Monday = 0) on a week, year and month
&gt;&gt;&gt; get_date_from_weekday(1, 2019, 10, 4)
numpy.datetime64(‘2019-10-22’)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat.account">
<span id="pyqstrat-account-module"></span><h2>pyqstrat.account module<a class="headerlink" href="#module-pyqstrat.account" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.account.Account">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.account.</span></span><span class="sig-name descname"><span class="pre">Account</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pnl_calc_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">900</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An Account calculates pnl for a set of contracts</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pnl_calc_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">900</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract_groups</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – Contract groups that we want to compute PNL for</p></li>
<li><p><strong>timestamps</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Timestamps that we might compute PNL at</p></li>
<li><p><strong>price_function</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – Function that returns contract prices used to compute pnl</p></li>
<li><p><strong>strategy_context</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>) – This is passed into the price function so we can use current state of strategy to compute prices</p></li>
<li><p><strong>starting_equity</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Starting equity in account currency.  Default 1.e6</p></li>
<li><p><strong>pnl_calc_time</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of minutes past midnight that we should calculate PNL at.  Default 15 * 60, i.e. 3 pm</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.add_trades">
<span class="sig-name descname"><span class="pre">add_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trades</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.add_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.add_trades" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.calc">
<span class="sig-name descname"><span class="pre">calc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.calc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.calc" title="Link to this definition">¶</a></dt>
<dd><p>Computes P&amp;L and stores it internally for all contracts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>timestamp</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – timestamp to compute P&amp;L at.  Account remembers the last timestamp it computed P&amp;L up to and will compute P&amp;L
between these and including timestamp. If there is more than one day between the last index and current index, we will
include pnl for at the defined pnl_calc_time for those dates as well.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.df_account_pnl">
<span class="sig-name descname"><span class="pre">df_account_pnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.df_account_pnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.df_account_pnl" title="Link to this definition">¶</a></dt>
<dd><p>Returns PNL at the account level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>contract_group</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – If set, we only return pnl for this contract_group.  Otherwise we return pnl for all contract groups</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.df_pnl">
<span class="sig-name descname"><span class="pre">df_pnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.df_pnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.df_pnl" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe with P&amp;L columns broken down by contract group and symbol</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>contract_group</strong> – Return PNL for this contract group.  If None (default), include all contract groups</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.df_roundtrip_trades">
<span class="sig-name descname"><span class="pre">df_roundtrip_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.df_roundtrip_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.df_roundtrip_trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe of round trip trades</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract_group</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – Return trades for this contract group. If None (default), include all contract groups</p></li>
<li><p><strong>start_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Include trades with date greater than or equal to this timestamp.</p></li>
<li><p><strong>end_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Include trades with date less than or equal to this timestamp.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.df_trades">
<span class="sig-name descname"><span class="pre">df_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.df_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.df_trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe of trades</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract_group</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – Return trades for this contract group. If None (default), include all contract groups</p></li>
<li><p><strong>start_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Include trades with date greater than or equal to this timestamp.</p></li>
<li><p><strong>end_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Include trades with date less than or equal to this timestamp.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.equity">
<span class="sig-name descname"><span class="pre">equity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.equity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.equity" title="Link to this definition">¶</a></dt>
<dd><p>Returns equity in this account in Account currency.  Will cause calculation if Account has not previously
calculated up to this date</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.get_trades_for_date">
<span class="sig-name descname"><span class="pre">get_trades_for_date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.get_trades_for_date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.get_trades_for_date" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.position">
<span class="sig-name descname"><span class="pre">position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.position"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.position" title="Link to this definition">¶</a></dt>
<dd><p>Returns netted position for a contract_group at a given date in number of contracts or shares.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.positions">
<span class="sig-name descname"><span class="pre">positions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.positions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.positions" title="Link to this definition">¶</a></dt>
<dd><p>Returns all non-zero positions in a contract group</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.roundtrip_trades">
<span class="sig-name descname"><span class="pre">roundtrip_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.roundtrip_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.roundtrip_trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a list of round trip trades with the given symbol and with trade date
between (and including) start date and end date if they are specified.
If symbol is None trades for all symbols are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.RoundTripTrade" title="pyqstrat.pq_types.RoundTripTrade"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoundTripTrade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.symbols">
<span class="sig-name descname"><span class="pre">symbols</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.symbols"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.symbols" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.Account.trades">
<span class="sig-name descname"><span class="pre">trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#Account.trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.Account.trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a list of trades with the given symbol and with trade date between (and including) start date
and end date if they are specified. If symbol is None trades for all symbols are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.account.ContractPNL">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.account.</span></span><span class="sig-name descname"><span class="pre">ContractPNL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account_timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#ContractPNL"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.ContractPNL" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Computes pnl for a single contract over time given trades and market data
&gt;&gt;&gt; from pyqstrat.pq_types import MarketOrder
&gt;&gt;&gt; Contract.clear_cache()
&gt;&gt;&gt; aapl_contract = Contract.create(‘AAPL’)
&gt;&gt;&gt; timestamps = np.arange(np.datetime64(‘2018-01-01’), np.datetime64(‘2018-01-04’))
&gt;&gt;&gt; def get_price(contract, timestamps, idx, strategy_context):
…    assert contract.symbol == ‘AAPL’, f’unknown contract: {contract}’
…    return idx + 10.1</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">contract_pnl</span> <span class="o">=</span> <span class="n">ContractPNL</span><span class="p">(</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">get_price</span><span class="p">,</span> <span class="n">SimpleNamespace</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trade_5</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">MarketOrder</span><span class="p">(</span><span class="n">contract</span><span class="o">=</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">qty</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">timestamps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">16.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trade_6</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">MarketOrder</span><span class="p">(</span><span class="n">contract</span><span class="o">=</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">qty</span><span class="o">=-</span><span class="mi">20</span><span class="p">),</span> <span class="n">timestamps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">16.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trade_7</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">MarketOrder</span><span class="p">(</span><span class="n">contract</span><span class="o">=</span><span class="n">aapl_contract</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">qty</span><span class="o">=-</span><span class="mi">20</span><span class="p">),</span> <span class="n">timestamps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">16.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract_pnl</span><span class="o">.</span><span class="n">_add_trades</span><span class="p">([</span><span class="n">trade_5</span><span class="p">,</span> <span class="n">trade_6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract_pnl</span><span class="o">.</span><span class="n">_add_trades</span><span class="p">([</span><span class="n">trade_7</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">contract_pnl</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">row</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-03 00:00:00&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mf">12.1</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;unrealized&#39;</span><span class="p">:</span> <span class="mf">44.0</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;realized&#39;</span><span class="p">:</span> <span class="mf">3.000000000000007</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;commission&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span><span class="s1">&#39;net_pnl&#39;</span><span class="p">:</span> <span class="mf">47.00000000000001</span><span class="p">}</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.ContractPNL.calc_net_pnl">
<span class="sig-name descname"><span class="pre">calc_net_pnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#ContractPNL.calc_net_pnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.ContractPNL.calc_net_pnl" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.ContractPNL.df">
<span class="sig-name descname"><span class="pre">df</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#ContractPNL.df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.ContractPNL.df" title="Link to this definition">¶</a></dt>
<dd><p>Returns a pandas dataframe with pnl data</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.ContractPNL.net_pnl">
<span class="sig-name descname"><span class="pre">net_pnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#ContractPNL.net_pnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.ContractPNL.net_pnl" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.ContractPNL.pnl">
<span class="sig-name descname"><span class="pre">pnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#ContractPNL.pnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.ContractPNL.pnl" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.account.ContractPNL.position">
<span class="sig-name descname"><span class="pre">position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#ContractPNL.position"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.ContractPNL.position" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.account.find_index_before">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.account.</span></span><span class="sig-name descname"><span class="pre">find_index_before</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sorted_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#find_index_before"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.find_index_before" title="Link to this definition">¶</a></dt>
<dd><p>Find index of the first key in a sorted dict that is less than or equal to the key passed in.
If the key is less than the first key in the dict, return -1</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.account.find_last_non_nan_index">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.account.</span></span><span class="sig-name descname"><span class="pre">find_last_non_nan_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#find_last_non_nan_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.find_last_non_nan_index" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.account.leading_nan_to_zero">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.account.</span></span><span class="sig-name descname"><span class="pre">leading_nan_to_zero</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#leading_nan_to_zero"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.leading_nan_to_zero" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.account.test_account">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.account.</span></span><span class="sig-name descname"><span class="pre">test_account</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/account.html#test_account"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.account.test_account" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyqstrat.strategy">
<span id="pyqstrat-strategy-module"></span><h2>pyqstrat.strategy module<a class="headerlink" href="#module-pyqstrat.strategy" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy.</span></span><span class="sig-name descname"><span class="pre">Strategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pnl_calc_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">961</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_lag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_final_calc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_trades</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_orders</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pnl_calc_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">961</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trade_lag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_final_calc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_trades</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_orders</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamps</strong> (<em>np.array</em><em> of </em><em>np.datetime64</em>) – The “heartbeat” of the strategy.  We will evaluate trading rules and
simulate the market at these times.</p></li>
<li><p><strong>contract_groups</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – The contract groups we will potentially trade.</p></li>
<li><p><strong>price_function</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – A function that returns the price of a contract at a given timestamp</p></li>
<li><p><strong>starting_equity</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Starting equity in Strategy currency.  Default 1.e6</p></li>
<li><p><strong>pnl_calc_time</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Time of day used to calculate PNL.  Default 15 * 60 (3 pm)</p></li>
<li><p><strong>trade_lag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of bars you want between the order and the trade.  For example, if you think it will take
5 seconds to place your order in the market, and your bar size is 1 second, set this to 5.  Set this to 0 if you
want to execute your trade at the same time as you place the order, for example, if you have daily bars.  Default 0.</p></li>
<li><p><strong>run_final_calc</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, calculates unrealized pnl and net pnl as well as realized pnl when strategy is done.
If you don’t need unrealized pnl, turn this off for faster run time. Default True</p></li>
<li><p><strong>strategy_context</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>]) – A storage class where you can store key / value pairs relevant to this strategy.
For example, you may have a pre-computed table of correlations that you use in the indicator or trade rule functions.
If not set, the __init__ function will create an empty member strategy_context object that you can access.</p></li>
<li><p><strong>log_trades</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, we log orders as they are created</p></li>
<li><p><strong>log_orders</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, we log trades as they are created</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.add_indicator">
<span class="sig-name descname"><span class="pre">add_indicator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depends_on</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_indicator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_indicator" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Name of the indicator</p></li>
<li><p><strong>indicator</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]) – A function that takes strategy timestamps and other indicators and returns a numpy array
containing indicator values.  The return array must have the same length as the timestamps object.</p></li>
<li><p><strong>contract_groups</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]]) – Contract groups that this indicator applies to.  If not set, it applies to all contract groups. Default None.</p></li>
<li><p><strong>depends_on</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – Names of other indicators that we need to compute this indicator. Default None.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.add_market_sim">
<span class="sig-name descname"><span class="pre">add_market_sim</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market_sim_function</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_market_sim"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_market_sim" title="Link to this definition">¶</a></dt>
<dd><p>Add a market simulator.  A market simulator is a function that takes orders as input and returns trades.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.add_rule">
<span class="sig-name descname"><span class="pre">add_rule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rule_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_true_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_rule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_rule" title="Link to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Add a trading rule.  Trading rules are guaranteed to run in the order in which you add them.  For example, if you set trade_lag to 0,</dt><dd><p>and want to exit positions and re-enter new ones in the same bar, make sure you add the exit rule before you add the entry rule to the
strategy.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Name of the trading rule</p></li>
<li><p><strong>rule_function</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <a class="reference internal" href="#pyqstrat.account.Account" title="pyqstrat.account.Account"><code class="xref py py-class docutils literal notranslate"><span class="pre">Account</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>], <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]]) – A trading rule function that returns a list of Orders</p></li>
<li><p><strong>signal_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The strategy will call the trading rule function when the signal with this name matches sig_true_values</p></li>
<li><p><strong>sig_true_values</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]) – If the signal value at a bar is equal to one of these values,
the Strategy will call the trading rule function.  Default [TRUE]</p></li>
<li><p><strong>position_filter</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – Can be “zero”, “nonzero”, “positive”, “negative” or None.
Rules are only triggered when the corresponding contract positions fit the criteria.
For example, a positive rule is only triggered when the current position for that contract is &gt; 0
If not set, we don’t look at the position before triggering the rule. Default None</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.add_signal">
<span class="sig-name descname"><span class="pre">add_signal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depends_on_indicators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depends_on_signals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.add_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.add_signal" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Name of the signal</p></li>
<li><p><strong>signal_function</strong> (<em>function</em>) – A function that takes timestamps and a dictionary of indicator value arrays and
returns a numpy array
containing signal values.  The return array must have the same length as the input timestamps</p></li>
<li><p><strong>contract_groups</strong> (list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ContractGroup</span></code>, optional) – Contract groups that this signal applies to.
If not set, it applies to all contract groups.  Default None.</p></li>
<li><p><strong>depends_on_indicators</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Names of indicators that we need to compute this signal. Default None.</p></li>
<li><p><strong>depends_on_signals</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Names of other signals that we need to compute this signal. Default None.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.df_data">
<span class="sig-name descname"><span class="pre">df_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_pnl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_data" title="Link to this definition">¶</a></dt>
<dd><p>Add indicators and signals to end of market data and return as a pandas dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract_groups</strong> (list of:obj:<cite>ContractGroup</cite>, optional) – list of contract groups to include.  All if set to None (default)</p></li>
<li><p><strong>add_pnl</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If True (default), include P&amp;L columns in dataframe</p></li>
<li><p><strong>start_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – string or numpy datetime64. Default None</p></li>
<li><p><strong>end_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – string or numpy datetime64: Default None</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.df_orders">
<span class="sig-name descname"><span class="pre">df_orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_orders" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe with data from orders with the given contract group and with order date between (and including)
start date and end date
if they are specified. If contract_group is None orders for all contract_groups are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.df_pnl">
<span class="sig-name descname"><span class="pre">df_pnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_pnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_pnl" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe with P&amp;L columns.  If contract group is set to None (default), sums up P&amp;L across all contract groups</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.df_returns">
<span class="sig-name descname"><span class="pre">df_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'D'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_returns" title="Link to this definition">¶</a></dt>
<dd><p>Return a dataframe of returns and equity indexed by date.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract_group</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]) – The contract group to get returns for.
If set to None (default), we return the sum of PNL for all contract groups</p></li>
<li><p><strong>sampling_frequency</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Downsampling frequency.  Default is None.  See pandas frequency strings for possible values</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.df_roundtrip_trades">
<span class="sig-name descname"><span class="pre">df_roundtrip_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_roundtrip_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_roundtrip_trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe of round trip trades with the given contract group and with trade date
between (and including) start date and end date if they are specified. If contract_group is None trades for all
contract_groups are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.df_trades">
<span class="sig-name descname"><span class="pre">df_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.df_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.df_trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe with data from trades with the given contract group and with trade date between (and including)
start date and end date
if they are specified. If contract_group is None trades for all contract_groups are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.evaluate_returns">
<span class="sig-name descname"><span class="pre">evaluate_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display_summary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_metrics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.evaluate_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.evaluate_returns" title="Link to this definition">¶</a></dt>
<dd><p>Computes return metrics and does or more of plotting, displaying or returning them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contract_group</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">ContractGroup</span></code>, optional) – Contract group to evaluate or None (default) for all contract groups</p></li>
<li><p><strong>periods_per_year</strong> (<em>int</em>) – If set to 0, we try to infer the frequency from the timestamps in the returns
sometimes this is not possible, for example if you have daily returns with random gaps in the days
In that case, you should set this value yourself. Use 252 if returns are on a daily frequency</p></li>
<li><p><strong>plot</strong> (<em>bool</em>) – If set to True, display plots of equity, drawdowns and returns.  Default False</p></li>
<li><p><strong>float_precision</strong> (<em>float</em><em>, </em><em>optional</em>) – Number of significant figures to show in returns.  Default 4</p></li>
<li><p><strong>return_metrics</strong> (<em>bool</em><em>, </em><em>optional</em>) – If set, we return the computed metrics as a dictionary</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.orders">
<span class="sig-name descname"><span class="pre">orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.orders" title="Link to this definition">¶</a></dt>
<dd><p>Returns a list of orders with the given contract group and with order date between (and including) start date and
end date if they are specified.
If contract_group is None orders for all contract_groups are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.plot_returns">
<span class="sig-name descname"><span class="pre">plot_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.plot_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.plot_returns" title="Link to this definition">¶</a></dt>
<dd><p>Display plots of equity, drawdowns and returns for the given contract group or for all contract groups if contract_group
is None (default)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Figure</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.roundtrip_trades">
<span class="sig-name descname"><span class="pre">roundtrip_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.roundtrip_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.roundtrip_trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a list of trades with the given contract group and with trade date between (and including) start date
and end date if they are specified.
If contract_group is None trades for all contract_groups are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.RoundTripTrade" title="pyqstrat.pq_types.RoundTripTrade"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoundTripTrade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.run_indicators">
<span class="sig-name descname"><span class="pre">run_indicators</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indicator_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear_all</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run_indicators"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run_indicators" title="Link to this definition">¶</a></dt>
<dd><p>Calculate values of the indicators specified and store them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>indicator_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – list of indicator names.  If None (default) run all indicators</p></li>
<li><p><strong>contract_groups</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]]) – Contract group to run this indicator for.  If None (default), we run it for all contract groups.</p></li>
<li><p><strong>clear_all</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, clears all indicator values before running.  Default False.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.run_rules">
<span class="sig-name descname"><span class="pre">run_rules</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rule_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run_rules"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run_rules" title="Link to this definition">¶</a></dt>
<dd><p>Run trading rules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rule_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – list of rule names.  If None (default) run all rules</p></li>
<li><p><strong>contract_groups</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]]) – Contract groups to run this rule for.  If None (default), we run it for all contract groups.</p></li>
<li><p><strong>start_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Run rules starting from this date. Default None</p></li>
<li><p><strong>end_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Don’t run rules after this date.  Default None</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.run_signals">
<span class="sig-name descname"><span class="pre">run_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear_all</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.run_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.run_signals" title="Link to this definition">¶</a></dt>
<dd><p>Calculate values of the signals specified and store them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – list of signal names.  If None (default) run all signals</p></li>
<li><p><strong>contract_groups</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>]]) – Contract groups to run this signal for. If None (default), we run it for all contract groups.</p></li>
<li><p><strong>clear_all</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, clears all signal values before running.  Default False.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy.Strategy.trades">
<span class="sig-name descname"><span class="pre">trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy.html#Strategy.trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy.Strategy.trades" title="Link to this definition">¶</a></dt>
<dd><p>Returns a list of trades with the given contract group and with trade date between (and including) start date
and end date if they are specified.
If contract_group is None trades for all contract_groups are returned</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-pyqstrat.portfolio">
<span id="pyqstrat-portfolio-module"></span><h2>pyqstrat.portfolio module<a class="headerlink" href="#module-pyqstrat.portfolio" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.portfolio.</span></span><span class="sig-name descname"><span class="pre">Portfolio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'main'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A portfolio contains one or more strategies that run concurrently so you can test running strategies that are uncorrelated together.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'main'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Args:
name: String used for displaying this portfolio</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.add_strategy">
<span class="sig-name descname"><span class="pre">add_strategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.add_strategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.add_strategy" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Name of the strategy</p></li>
<li><p><strong>strategy</strong> (<a class="reference internal" href="#pyqstrat.strategy.Strategy" title="pyqstrat.strategy.Strategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">Strategy</span></code></a>) – Strategy instance</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.df_returns">
<span class="sig-name descname"><span class="pre">df_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.df_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.df_returns" title="Link to this definition">¶</a></dt>
<dd><p>Return dataframe containing equity and returns with a date index.  Equity and returns are combined from all strategies passed in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sampling_frequency</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Date frequency for rows.  Default ‘D’ for daily so we will have one row per day</p></li>
<li><p><strong>strategy_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – By default this is set to None and we use all strategies.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.evaluate_returns">
<span class="sig-name descname"><span class="pre">evaluate_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.evaluate_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.evaluate_returns" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dictionary of common return metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sampling_frequency</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Date frequency.  Default ‘D’ for daily so we downsample to daily returns before computing metrics</p></li>
<li><p><strong>strategy_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – By default this is set to None and we use all strategies.</p></li>
<li><p><strong>plot</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set to True, display plots of equity, drawdowns and returns.  Default False</p></li>
<li><p><strong>float_precision</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of significant figures to show in returns.  Default 4</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sampling_frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.plot" title="Link to this definition">¶</a></dt>
<dd><p>Display plots of equity, drawdowns and returns</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sampling_frequency</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Date frequency.  Default ‘D’ for daily so we downsample to daily returns before computing metrics</p></li>
<li><p><strong>strategy_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – A list of strategy names.  By default this is set to None and we use all strategies.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.run" title="Link to this definition">¶</a></dt>
<dd><p>Run indicators, signals and rules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>strategy_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – A list of strategy names.  By default this is set to None and we use all strategies.</p></li>
<li><p><strong>start_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Run rules starting from this date.
Sometimes we have a few strategies in a portfolio that need different lead times before they are ready to trade
so you can set this so they are all ready by this date.  Default None</p></li>
<li><p><strong>end_date</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code>) – Don’t run rules after this date.  Default None</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.run_indicators">
<span class="sig-name descname"><span class="pre">run_indicators</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.run_indicators"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.run_indicators" title="Link to this definition">¶</a></dt>
<dd><p>Compute indicators for the strategies specified</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>strategy_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – By default this is set to None and we use all strategies.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.run_rules">
<span class="sig-name descname"><span class="pre">run_rules</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">numpy.datetime64('NaT')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.run_rules"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.run_rules" title="Link to this definition">¶</a></dt>
<dd><p>Run rules for the strategies specified.  Must be called after run_indicators and run_signals.
See run function for argument descriptions</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.portfolio.Portfolio.run_signals">
<span class="sig-name descname"><span class="pre">run_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/portfolio.html#Portfolio.run_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.portfolio.Portfolio.run_signals" title="Link to this definition">¶</a></dt>
<dd><p>Compute signals for the strategies specified.  Must be called after run_indicators</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>strategy_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – By default this is set to None and we use all strategies.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-pyqstrat.optimize">
<span id="pyqstrat-optimize-module"></span><h2>pyqstrat.optimize module<a class="headerlink" href="#module-pyqstrat.optimize" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.optimize.Experiment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.optimize.</span></span><span class="sig-name descname"><span class="pre">Experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">suggestion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">other_costs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Experiment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Experiment" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An Experiment stores a suggestion and its result</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Experiment.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">suggestion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">other_costs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Experiment.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Experiment.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>suggestion</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – A dictionary of variable name -&gt; value</p></li>
<li><p><strong>cost</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – A float representing output of the function we are testing with this suggestion as input.</p></li>
<li><p><strong>other_costs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – A dictionary of other results we want to store and look at later.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Experiment.valid">
<span class="sig-name descname"><span class="pre">valid</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Experiment.valid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Experiment.valid" title="Link to this definition">¶</a></dt>
<dd><p>Returns True if all suggestions and costs are finite, i.e not NaN or +/- Infinity</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.optimize.</span></span><span class="sig-name descname"><span class="pre">Optimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_processes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Optimizer is used to optimize parameters for a strategy.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_processes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Display title for plotting, etc.</p></li>
<li><p><strong>generator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Generator</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – A generator (see Python Generators) that takes no inputs and yields a dictionary with parameter name -&gt; parameter value.</p></li>
<li><p><strong>cost_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]], <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]]]) – A function that takes a dictionary of parameter name -&gt; parameter value as input and outputs cost for that set of parameters.</p></li>
<li><p><strong>max_processes</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – If not set, the Optimizer will look at the number of CPU cores on your machine to figure out how many processes to run.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer.df_experiments">
<span class="sig-name descname"><span class="pre">df_experiments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sort_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cost'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ascending</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.df_experiments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.df_experiments" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dataframe containing experiment data, sorted by sort_column (default “cost”)</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer.experiment_list">
<span class="sig-name descname"><span class="pre">experiment_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sort_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lowest_cost'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.experiment_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.experiment_list" title="Link to this definition">¶</a></dt>
<dd><p>Returns the list of experiments we have run</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sort_order</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Can be set to lowest_cost, highest_cost or sequence.
If set to sequence, experiments are returned in the sequence in which they were run</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.optimize.Experiment" title="pyqstrat.optimize.Experiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer.plot_2d">
<span class="sig-name descname"><span class="pre">plot_2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lines+markers'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.plot_2d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.plot_2d" title="Link to this definition">¶</a></dt>
<dd><p>Creates a 2D plot of the optimization output for plotting 1 parameter and costs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Name of the parameter to plot on the x axis, corresponding to the same name in the generator.</p></li>
<li><p><strong>y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Can be one of:
“cost”
The name of another cost variable corresponding to the output from the cost function
“all”, which creates a subplot for cost plus all other costs</p></li>
<li><p><strong>marker_mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – see plotly mode.  Set to ‘lines’ to turn markers off</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Figure</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer.plot_3d">
<span class="sig-name descname"><span class="pre">plot_3d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">markers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vertical_spacing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.plot_3d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.plot_3d" title="Link to this definition">¶</a></dt>
<dd><p>Creates a 3D plot of the optimization output for plotting 2 parameters and costs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Name of the parameter to plot on the x axis, corresponding to the same name in the generator.</p></li>
<li><p><strong>y</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Name of the parameter to plot on the y axis, corresponding to the same name in the generator.</p></li>
<li><p><strong>z</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Can be one of
cost, the name of another cost variable corresponding to the output from the cost function
all, which creates a subplot for cost plus all other costs</p></li>
<li><p><strong>markers</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, we show actual datapoints on the graph</p></li>
<li><p><strong>filter_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]]) – A function that can be used to reduce the dataset before plotting.
For example, you may want to filter on a dimension beyond x, y, z to pick a single value
from that dimension</p></li>
<li><p><strong>marker</strong> – Adds a marker to each point in x, y, z to show the actual data used for interpolation.  You can set this to None to turn markers off.</p></li>
<li><p><strong>vertical_spacing</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Vertical space between subplots</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Figure</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.optimize.Optimizer.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raise_on_error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#Optimizer.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.Optimizer.run" title="Link to this definition">¶</a></dt>
<dd><p>Run the optimizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>raise_on_error</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set to True, even if we are running a multiprocess optimization, any Exceptions will bubble up and stop the Optimizer.
This can be useful for debugging to see stack traces for Exceptions.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.optimize.flatten_keys">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.optimize.</span></span><span class="sig-name descname"><span class="pre">flatten_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#flatten_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.flatten_keys" title="Link to this definition">¶</a></dt>
<dd><p>Utility function so we can find all keys for other costs in all experiments even if the first experiment
does not have all of them</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.optimize.test_optimize">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.optimize.</span></span><span class="sig-name descname"><span class="pre">test_optimize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/optimize.html#test_optimize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.optimize.test_optimize" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-pyqstrat.evaluator">
<span id="pyqstrat-evaluator-module"></span><h2>pyqstrat.evaluator module<a class="headerlink" href="#module-pyqstrat.evaluator" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">Evaluator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initial_metrics</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>You add functions to the evaluator that are dependent on the outputs of other functions.
The evaluator will call these functions in the right order
so dependencies are computed first before the functions that need their output.
You can retrieve the output of a metric using the metric member function</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span><span class="n">initial_metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">add_metric</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="go">array([ 9, 10, 11])</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initial_metrics</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Inits Evaluator with a dictionary of initial metrics that are used to compute subsequent metrics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>initial_metrics</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – a dictionary of string name -&gt; metric.  metric can be any object including a scalar,
an array or a tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator.add_metric">
<span class="sig-name descname"><span class="pre">add_metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dependencies</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.add_metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.add_metric" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metric_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.compute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.compute" title="Link to this definition">¶</a></dt>
<dd><p>Compute metrics using the internal dependency graph</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metric_names</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – an array of metric names.  If not passed in, evaluator will compute and store all metrics</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator.compute_metric">
<span class="sig-name descname"><span class="pre">compute_metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metric_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.compute_metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.compute_metric" title="Link to this definition">¶</a></dt>
<dd><p>Compute and store a single metric:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metric_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – string representing the metric to compute</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metric_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.metric" title="Link to this definition">¶</a></dt>
<dd><p>Return the value of a single metric given its name</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.evaluator.Evaluator.metrics">
<span class="sig-name descname"><span class="pre">metrics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#Evaluator.metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.Evaluator.metrics" title="Link to this definition">¶</a></dt>
<dd><p>Return a dictionary of metric name -&gt; metric value</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_amean">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_amean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_amean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_amean" title="Link to this definition">¶</a></dt>
<dd><p>Computes arithmetic mean of a return array, ignoring NaNs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>returns</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Represents returns at any frequency</p></li>
<li><p><strong>periods_per_year</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Frequency of the returns, e.g. 252 for daily returns</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compute_amean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]),</span> <span class="mi">252</span><span class="p">)</span>
<span class="go">0.882</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_annual_returns">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_annual_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_annual_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_annual_returns" title="Link to this definition">¶</a></dt>
<dd><p>Takes the output of compute_bucketed_returns and returns geometric mean of returns by year</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple with the first element being an array of years (integer) and the second element
an array of annualized returns for those years</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_bucketed_returns">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_bucketed_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_bucketed_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_bucketed_returns" title="Link to this definition">¶</a></dt>
<dd><p>Bucket returns by year</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A tuple with the first element being a list of years and the second a list of</dt><dd><p>numpy arrays containing returns for each corresponding year</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_calmar">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_calmar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns_3yr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mdd_pct_3yr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_calmar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_calmar" title="Link to this definition">¶</a></dt>
<dd><p>Compute Calmar ratio, which is the annualized return divided by max drawdown over the last 3 years</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_dates_3yr">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_dates_3yr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_dates_3yr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_dates_3yr" title="Link to this definition">¶</a></dt>
<dd><p>Given an array of numpy datetimes, return those that are within 3 years of the last date in the array</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_equity">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_equity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_equity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_equity" title="Link to this definition">¶</a></dt>
<dd><p>Given starting equity, timestamps and returns, create a numpy array of equity at each date</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_gmean">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_gmean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_gmean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_gmean" title="Link to this definition">¶</a></dt>
<dd><p>Compute geometric mean of an array of returns</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>returns</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy array of returns, can contain nans</p></li>
<li><p><strong>periods_per_year</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Used for annualizing returns</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">compute_gmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-05-01&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[D]&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">]),</span> <span class="mf">252.</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">0.018362</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_k_ratio">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_k_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">halflife_years</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_k_ratio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_k_ratio" title="Link to this definition">¶</a></dt>
<dd><p>Compute k-ratio (2013 or original versions by Lars Kestner). See <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2230949">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2230949</a>
We also implement a modification that allows higher weighting for more recent returns.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equity</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy array of the equity in your account</p></li>
<li><p><strong>periods_per_year</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – 252 for daily values</p></li>
<li><p><strong>halflife_years</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – If set, we use weighted linear regression to give less weight to older returns.
In this case, we compute the original k-ratio which does not use periods per year or number of observations
If not set, we compute the 2013 version of the k-ratio which weights k-ratio by sqrt(periods_per_year) / nobs</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>weighted or unweighted k-ratio</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mf">0.0025</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">equity</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ret</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">compute_k_ratio</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="mf">3.888</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">compute_k_ratio</span><span class="p">(</span><span class="n">equity</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mf">602.140</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_mar">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_mar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mdd_pct</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_mar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_mar" title="Link to this definition">¶</a></dt>
<dd><p>Compute MAR ratio, which is annualized return divided by biggest drawdown since inception.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_maxdd_date">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_maxdd_date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dd_dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_dd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_date"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_date" title="Link to this definition">¶</a></dt>
<dd><p>Compute date of max drawdown given numpy array of timestamps, and corresponding rolling dd percentages</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_maxdd_date_3yr">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_maxdd_date_3yr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dd_3yr_timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_dd_3yr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_date_3yr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_date_3yr" title="Link to this definition">¶</a></dt>
<dd><p>Compute max drawdown date over the last 3 years</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_maxdd_pct">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_maxdd_pct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_pct"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_pct" title="Link to this definition">¶</a></dt>
<dd><p>Compute max drawdown percentage given a numpy array of rolling drawdowns, ignoring NaNs</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_maxdd_pct_3yr">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_maxdd_pct_3yr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dd_3yr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_pct_3yr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_pct_3yr" title="Link to this definition">¶</a></dt>
<dd><p>Compute max drawdown percentage over the last 3 years</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_maxdd_start">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_maxdd_start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dd_dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_dd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mdd_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_start" title="Link to this definition">¶</a></dt>
<dd><p>Compute date when max drawdown starts, given numpy array of timestamps corresponding rolling dd
percentages and date of the max draw down</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_maxdd_start_3yr">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_maxdd_start_3yr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rolling_dd_3yr_timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling_dd_3yr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mdd_date_3yr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_maxdd_start_3yr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_maxdd_start_3yr" title="Link to this definition">¶</a></dt>
<dd><p>Comput max drawdown start date over the last 3 years</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_num_periods">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_num_periods</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_num_periods"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_num_periods" title="Link to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Given an array of timestamps, we compute how many periods there are between the first and last element, where the length</dt><dd><p>of a period is defined by periods_per_year.  For example, if there are 6 periods per year,
then each period would be approx. 2 months long.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamps</strong> (<em>np.ndarray</em><em> of </em><em>np.datetime64</em>) – a numpy array of returns, can contain nans</p></li>
<li><p><strong>periods_per_year</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – number of periods between first and last return</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">compute_num_periods</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-07-01&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[D]&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_periods_per_year">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_periods_per_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_periods_per_year"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_periods_per_year" title="Link to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Computes trading periods per year for an array of numpy datetime64’s.</dt><dd><p>e.g. if most of the timestamps are separated by 1 day, will return 252.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>timestamps</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy array of datetime64’s</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compute_periods_per_year</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-10&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[D]&#39;</span><span class="p">))</span>
<span class="go">:rtype: :py:class:`float`</span>
<span class="go">252.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">compute_periods_per_year</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2018-01-01 10:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 10:05&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 10:10&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[m]&#39;</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">72576.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_return_metrics">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_return_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leading_non_finite_to_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsequent_non_finite_to_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_return_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_return_metrics" title="Link to this definition">¶</a></dt>
<dd><p>Compute a set of common metrics using returns (for example, of an instrument or a portfolio)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamps</strong> (<em>np.array</em><em> of </em><em>datetime64</em>) – Timestamps for the returns</p></li>
<li><p><strong>rets</strong> (<em>nd.array</em><em> of </em><em>float</em>) – The returns, use 0.01 for 1%</p></li>
<li><p><strong>starting_equity</strong> (<em>float</em>) – Starting equity value in your portfolio</p></li>
<li><p><strong>leading_non_finite_to_zeros</strong> (<em>bool</em><em>, </em><em>optional</em>) – If set, we replace leading nan, inf, -inf returns with zeros.
For example, you may need a warmup period for moving averages.  Default False</p></li>
<li><p><strong>subsequent_non_finite_to_zeros</strong> (<em>bool</em><em>, </em><em>optional</em>) – If set, we replace any nans that follow the first non nan value with zeros.
There may be periods where you have no prices but removing these returns would result in incorrect annualization.
Default True</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#pyqstrat.evaluator.Evaluator" title="pyqstrat.evaluator.Evaluator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Evaluator</span></code></a></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>An Evaluator object containing computed metrics off the returns passed in.
If needed, you can add your own metrics to this object based on the values of existing metrics and recompute the Evaluator.
Otherwise, you can just use the output of the evaluator using the metrics function.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-07-01&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;M8[D]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.015</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">starting_equity</span> <span class="o">=</span> <span class="mf">1.e6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ev</span> <span class="o">=</span> <span class="n">compute_return_metrics</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">rets</span><span class="p">,</span> <span class="n">starting_equity</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metrics</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">metrics</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;gmean&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.03122</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;sharpe&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.594366</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;returns_3yr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.015</span><span class="p">])))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_returns_3yr">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_returns_3yr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_returns_3yr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_returns_3yr" title="Link to this definition">¶</a></dt>
<dd><p>Given an array of numpy datetimes and an array of returns, return those that are within 3 years
of the last date in the datetime array</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_rolling_dd">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_rolling_dd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equity</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_rolling_dd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_rolling_dd" title="Link to this definition">¶</a></dt>
<dd><p>Compute numpy array of rolling drawdown percentage</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamps</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – numpy array of datetime64</p></li>
<li><p><strong>equity</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – numpy array of equity</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_rolling_dd_3yr">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_rolling_dd_3yr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equity</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_rolling_dd_3yr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_rolling_dd_3yr" title="Link to this definition">¶</a></dt>
<dd><p>Compute rolling drawdowns over the last 3 years</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_sharpe">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_sharpe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amean</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_sharpe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_sharpe" title="Link to this definition">¶</a></dt>
<dd><p>Note that this does not take into risk free returns so it’s really a sharpe0, i.e. assumes risk free returns are 0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>returns</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy array of returns</p></li>
<li><p><strong>amean</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – arithmetic mean of returns</p></li>
<li><p><strong>periods_per_year</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – number of trading periods per year</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">compute_sharpe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">]),</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">0.050508</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_sortino">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_sortino</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amean</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods_per_year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_sortino"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_sortino" title="Link to this definition">¶</a></dt>
<dd><p>Note that this assumes target return is 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>returns</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a numpy array of returns</p></li>
<li><p><strong>amean</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – arithmetic mean of returns</p></li>
<li><p><strong>periods_per_year</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – number of trading periods per year</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">compute_sortino</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">]),</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
<span class="go">0.133631</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.compute_std">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">compute_std</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#compute_std"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.compute_std" title="Link to this definition">¶</a></dt>
<dd><p>Computes standard deviation of an array of returns, ignoring nans</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.display_return_metrics">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">display_return_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#display_return_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.display_return_metrics" title="Link to this definition">¶</a></dt>
<dd><p>Creates a dataframe making it convenient to view the output of the metrics obtained using the compute_return_metrics function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>float_precision</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Change if you want to display floats with more or less significant figures than the default,
3 significant figures.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A one row dataframe with formatted metrics.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.handle_non_finite_returns">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">handle_non_finite_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leading_non_finite_to_zeros</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsequent_non_finite_to_zeros</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#handle_non_finite_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.handle_non_finite_returns" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{: .6g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2019-01-07&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_non_finite_returns</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">rets</span><span class="p">,</span> <span class="n">leading_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">subsequent_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="go">(array([&#39;2019-01-03&#39;, &#39;2019-01-04&#39;, &#39;2019-01-05&#39;, &#39;2019-01-06&#39;], dtype=&#39;datetime64[D]&#39;), array([ 3,  4,  0,  5]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_non_finite_returns</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">rets</span><span class="p">,</span> <span class="n">leading_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">subsequent_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">(array([&#39;2019-01-01&#39;, &#39;2019-01-02&#39;, &#39;2019-01-03&#39;, &#39;2019-01-04&#39;, &#39;2019-01-06&#39;], dtype=&#39;datetime64[D]&#39;), array([ 0,  0,  3,  4,  5]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_non_finite_returns</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">rets</span><span class="p">,</span> <span class="n">leading_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">subsequent_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">(array([&#39;2019-01-01&#39;, &#39;2019-01-02&#39;, &#39;2019-01-03&#39;, &#39;2019-01-04&#39;, &#39;2019-01-06&#39;], dtype=&#39;datetime64[D]&#39;), array([ 0,  0,  3,  4,  5]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span>  <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_non_finite_returns</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">rets</span><span class="p">,</span> <span class="n">leading_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">subsequent_non_finite_to_zeros</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="go">:rtype: :py:class:`tuple`\[:py:class:`~numpy.ndarray`, :py:class:`~numpy.ndarray`]</span>
</pre></div>
</div>
<dl class="simple">
<dt>(array([‘2019-01-01’, ‘2019-01-02’, ‘2019-01-03’, ‘2019-01-04’, ‘2019-01-05’, ‘2019-01-06’],</dt><dd><p>dtype=’datetime64[D]’), array([ 1,  2,  3,  4,  4.5,  5]))</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.plot_return_metrics">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">plot_return_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#plot_return_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.plot_return_metrics" title="Link to this definition">¶</a></dt>
<dd><p>Plot equity, rolling drawdowns and and a boxplot of annual returns given the output of compute_return_metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metrics</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – dict of metrics produced by compute_return_metrics</p></li>
<li><p><strong>title</strong> – title of the plot</p></li>
<li><p><strong>height</strong> – height of the plot</p></li>
<li><p><strong>width</strong> – width of the plot. If set to 0, lets plotly select the width</p></li>
<li><p><strong>show</strong> – whether to show the plot or just return it</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Figure</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.evaluator.test_evaluator">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.evaluator.</span></span><span class="sig-name descname"><span class="pre">test_evaluator</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/evaluator.html#test_evaluator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.evaluator.test_evaluator" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat.pyqstrat_cpp">
<span id="pyqstrat-pyqstrat-cpp-module"></span><h2>pyqstrat.pyqstrat_cpp module<a class="headerlink" href="#module-pyqstrat.pyqstrat_cpp" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.black_scholes_price">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">black_scholes_price</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">call</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.black_scholes_price" title="Link to this definition">¶</a></dt>
<dd><p>Compute Euroepean option price
:param call: True for a call option, False for a put
:type call: bool
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Option price</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.cdf">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">cdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.cdf" title="Link to this definition">¶</a></dt>
<dd><p>Cumulative density function of normal distribution
:param x: random variable
:type x: float</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>cdf of the random variable</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.d1">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">d1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.d1" title="Link to this definition">¶</a></dt>
<dd><p>d1 from Black Scholes
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%
:type q: float</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.d2">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">d2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.d2" title="Link to this definition">¶</a></dt>
<dd><p>d2 from Black Scholes
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%
:type q: float</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.delta">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">delta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">call</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.delta" title="Link to this definition">¶</a></dt>
<dd><p>Compute European option delta
:param call: True for a call option, False for a put
:type call: bool
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Option delta</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.gamma">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">gamma</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.gamma" title="Link to this definition">¶</a></dt>
<dd><p>Compute European option gamma.
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Option gamma</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.implied_vol">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">implied_vol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">call</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.implied_vol" title="Link to this definition">¶</a></dt>
<dd><p>Compute implied volatility for a European option.
:param call: True for a call option, False for a put
:type call: bool
:param price: The option premium
:type price: float
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Implied volatility.  For 1% we return 0.01</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.rho">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">rho</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">call</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.rho" title="Link to this definition">¶</a></dt>
<dd><p>Compute European option rho.  This is Black Scholes formula rho divided by 100 so we get rho per 1% change in interest rate
:param call: True for a European call option, False for a put
:type call: bool
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Option theta</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.theta">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">theta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">call</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">F</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.theta" title="Link to this definition">¶</a></dt>
<dd><p>Compute European option theta per day.  This is Black Scholes formula theta divided by 365 to give us the customary theta per day
:param call: True for a call option, False for a put
:type call: bool
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Option theta</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_cpp.vega">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_cpp.</span></span><span class="sig-name descname"><span class="pre">vega</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#pyqstrat.pyqstrat_cpp.vega" title="Link to this definition">¶</a></dt>
<dd><p>Compute European option vega.  This is Black Scholes formula vega divided by 100 so we get rho per 1% change in interest rate
:param S: Spot price. For a future discount the future price using exp(-rt)
:type S: float
:param K: Strike
:type K: float
:param t: Time to maturity in years
:type t: float
:param r: Continuously compounded interest rate.  Use 0.01 for 1%
:type r: float
:param sigma: Annualized volatility.  Use 0.01 for 1%
:type sigma: float
:param q: Annualized dividend yield.  Use 0.01 for 1%.  Default 0
:type q: float, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Option vega</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat.pyqstrat_io">
<span id="pyqstrat-pyqstrat-io-module"></span><h2>pyqstrat.pyqstrat_io module<a class="headerlink" href="#module-pyqstrat.pyqstrat_io" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_io.parse_datetimes">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_io.</span></span><span class="sig-name descname"><span class="pre">parse_datetimes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.pyqstrat_io.parse_datetimes" title="Link to this definition">¶</a></dt>
<dd><p>parse datetimes</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.pyqstrat_io.read_file">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.pyqstrat_io.</span></span><span class="sig-name descname"><span class="pre">read_file</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.pyqstrat_io.read_file" title="Link to this definition">¶</a></dt>
<dd><p>read a file</p>
</dd></dl>

</section>
<section id="module-pyqstrat.markets">
<span id="pyqstrat-markets-module"></span><h2>pyqstrat.markets module<a class="headerlink" href="#module-pyqstrat.markets" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiFuture">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.markets.</span></span><span class="sig-name descname"><span class="pre">EminiFuture</span></span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiFuture"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiFuture" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiFuture.calendar">
<span class="sig-name descname"><span class="pre">calendar</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;pyqstrat.holiday_calendars.Calendar</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#pyqstrat.markets.EminiFuture.calendar" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiFuture.get_current_symbol">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_current_symbol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">curr_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiFuture.get_current_symbol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiFuture.get_current_symbol" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">EminiFuture</span><span class="o">.</span><span class="n">get_current_symbol</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;ESH9&#39;</span><span class="p">)</span>
<span class="go">:rtype: :py:class:`str`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">EminiFuture</span><span class="o">.</span><span class="n">get_current_symbol</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;ESM9&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">EminiFuture</span><span class="o">.</span><span class="n">get_current_symbol</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;ESH0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiFuture.get_expiry">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_expiry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fut_symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiFuture.get_expiry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiFuture.get_expiry" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">EminiFuture</span><span class="o">.</span><span class="n">get_expiry</span><span class="p">(</span><span class="s1">&#39;ESH8&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-03-16T08:30&#39;</span><span class="p">))</span>
<span class="go">:rtype: :py:class:`~numpy.datetime64`</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiFuture.get_next_symbol">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_next_symbol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">curr_future_symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiFuture.get_next_symbol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiFuture.get_next_symbol" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">EminiFuture</span><span class="o">.</span><span class="n">get_next_symbol</span><span class="p">(</span><span class="s1">&#39;ESZ8&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ESH9&#39;</span><span class="p">)</span>
<span class="go">:rtype: :py:class:`str`</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiFuture.get_previous_symbol">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_previous_symbol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">curr_future_symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiFuture.get_previous_symbol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiFuture.get_previous_symbol" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">EminiFuture</span><span class="o">.</span><span class="n">get_previous_symbol</span><span class="p">(</span><span class="s1">&#39;ESH9&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ESZ8&#39;</span><span class="p">)</span>
<span class="go">:rtype: :py:class:`str`</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiOption">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.markets.</span></span><span class="sig-name descname"><span class="pre">EminiOption</span></span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiOption"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiOption" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiOption.calendar">
<span class="sig-name descname"><span class="pre">calendar</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;pyqstrat.holiday_calendars.Calendar</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#pyqstrat.markets.EminiOption.calendar" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiOption.decode_symbol">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">decode_symbol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiOption.decode_symbol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiOption.decode_symbol" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">weekday</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EminiOption</span><span class="o">.</span><span class="n">decode_symbol</span><span class="p">(</span><span class="s1">&#39;E1AF8&#39;</span><span class="p">)</span>
<span class="go">(MO, 2018, 1, 1)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.markets.EminiOption.get_expiry">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_expiry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#EminiOption.get_expiry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.EminiOption.get_expiry" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EminiOption</span><span class="o">.</span><span class="n">get_expiry</span><span class="p">(</span><span class="s1">&#39;EW2Z5&#39;</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2015-12-11T15:00&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">EminiOption</span><span class="o">.</span><span class="n">get_expiry</span><span class="p">(</span><span class="s1">&#39;E3AF7&#39;</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2017-01-17T15:00&#39;)</span>
<span class="go">:rtype: :py:class:`~numpy.datetime64`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EminiOption</span><span class="o">.</span><span class="n">get_expiry</span><span class="p">(</span><span class="s1">&#39;EWF0&#39;</span><span class="p">)</span>
<span class="go">numpy.datetime64(&#39;2020-01-31T15:00&#39;)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.markets.future_code_to_month">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.markets.</span></span><span class="sig-name descname"><span class="pre">future_code_to_month</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">future_code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#future_code_to_month"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.future_code_to_month" title="Link to this definition">¶</a></dt>
<dd><p>Given a future code such as “X”, return the month abbreviation, such as “nov”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>future_code</strong> (<em>str</em>) – the one letter future code</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">future_code_to_month</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="go">&#39;nov&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.markets.future_code_to_month_number">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.markets.</span></span><span class="sig-name descname"><span class="pre">future_code_to_month_number</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">future_code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#future_code_to_month_number"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.future_code_to_month_number" title="Link to this definition">¶</a></dt>
<dd><p>Given a future code such as “X”, return the month number (from 1 - 12)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>future_code</strong> (<em>str</em>) – the one letter future code</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">future_code_to_month_number</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="go">11</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.markets.get_future_code">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.markets.</span></span><span class="sig-name descname"><span class="pre">get_future_code</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">month</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/markets.html#get_future_code"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.markets.get_future_code" title="Link to this definition">¶</a></dt>
<dd><p>Given a month number such as 3 for March, return the future code for it, e.g. H
&gt;&gt;&gt; get_future_code(3)
‘H’</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat.strategy_builder">
<span id="pyqstrat-strategy-builder-module"></span><h2>pyqstrat.strategy_builder module<a class="headerlink" href="#module-pyqstrat.strategy_builder" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_builder.</span></span><span class="sig-name descname"><span class="pre">StrategyBuilder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A helper class that makes it easier to build simpler strategies by removing the need for a lot of boilerplate code.
The __call__ member function returns a Strategy built by this class that can then be run and evaluated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]) – A pandas dataframe containing columns for timestamps, indicators and signals</p></li>
<li><p><strong>timestamps</strong> – The ‘’heartbeat’’ of the strategy. A vector of each relevant time for this strategy</p></li>
<li><p><strong>timestamp_unit</strong> – Corresponds to bar length. Follows numpy datetime64 datatype strings.
For example if you have daily bars, use M8[D] and if you have minute bars use M8[m]</p></li>
<li><p><strong>contract_groups</strong> – Each contract has to be a part of a contract group for PNL aggregation, etc. This class builds
a contract group for each contract that is supplied to it, so this is only needed if you want to group contracts</p></li>
<li><p><strong>price_function</strong> – A function of type PriceFunctionType that we use to get market prices by contract name and timestamp</p></li>
<li><p><strong>pnl_calc_time</strong> – Since pnl is reported on a daily basis, this indicates the time (in minutes) for computing that PNL.
For example, if you want to compute PNL at 4:01 pm each day, use 16 * 60 + 1</p></li>
<li><p><strong>starting_equity</strong> – Equity to start the backtest with</p></li>
<li><p><strong>trade_lag</strong> – How long it takes for an order to get to the market (in bars). If you are using input data from 2:33:44 pm
it may take you less than one second to generate the order and send it to the market. In this case, assuming you
have 1 second bars, set the trade lag to 1. Market simulator get orders this many bars after the order is generated
by trading rules. Trade lag of 0 can be used for daily orders, when you want to relax the assumption that
it takes finite time to generate an order and send it to the market</p></li>
<li><p><strong>strategy_context</strong> – Properties that are passed into all user defined functions such as rule functions, signal functions.
For example, you may want to set a property that indicates commission per trade instead of
hardcoding it into a market simulator.</p></li>
<li><p><strong>indicators</strong> – Indicators are numeric vectors used to generate trading signals. For example, we may create an indicator
that has the overnight gap (difference between yesterday’s closing price and this morning’s open price)</p></li>
<li><p><strong>signals</strong> – Signals are boolean vectors used to determine whether or not we should run rules. For example, we may
want to run an entry rule if the indicator above is more than 1% of last night’s closing price. In this case
the signal value for the corresponding time bar would be set to True</p></li>
<li><p><strong>rules</strong> – Rules are functions that take indicators and signals as inputs and generate orders as outputs at each time bar.
Depending on the logic in each rule, it decides sizing, what kind of order to generate (limit, market, etc.)
and how many (or zero) orders to generate.</p></li>
<li><p><strong>market_sims</strong> – Market simulators simulate the execution of orders and generation of trades. The market sims are called
in order so two market simulators should not successfully process the same order</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Generates a strategy object that we can then run and evaluate</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.strategy.Strategy" title="pyqstrat.strategy.Strategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">Strategy</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_contract">
<span class="sig-name descname"><span class="pre">add_contract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_contract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_contract" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_contract_group">
<span class="sig-name descname"><span class="pre">add_contract_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_contract_group"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_contract_group" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_indicator">
<span class="sig-name descname"><span class="pre">add_indicator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depends_on</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_indicator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_indicator" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_market_sim">
<span class="sig-name descname"><span class="pre">add_market_sim</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">market_sim_function</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_market_sim"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_market_sim" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_rule">
<span class="sig-name descname"><span class="pre">add_rule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rule_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_true_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_rule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_rule" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_series_indicator">
<span class="sig-name descname"><span class="pre">add_series_indicator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_series_indicator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_series_indicator" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_series_rule">
<span class="sig-name descname"><span class="pre">add_series_rule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">column_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rule_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_series_rule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_series_rule" title="Link to this definition">¶</a></dt>
<dd><p>Helper function that makes it easier to create a signal by using a boolean column from
the dataframe passed in the constructor to this class</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.add_signal">
<span class="sig-name descname"><span class="pre">add_signal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depends_on_indicators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depends_on_signals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.add_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.add_signal" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.contract_groups">
<span class="sig-name descname"><span class="pre">contract_groups</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.contract_groups" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.data">
<span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.data" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.indicators">
<span class="sig-name descname"><span class="pre">indicators</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">],</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">]],</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]]]]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.indicators" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.log_orders">
<span class="sig-name descname"><span class="pre">log_orders</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.log_orders" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.log_trades">
<span class="sig-name descname"><span class="pre">log_trades</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.log_trades" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.market_sims">
<span class="sig-name descname"><span class="pre">market_sims</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a><span class="pre">]]]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.market_sims" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.pnl_calc_time">
<span class="sig-name descname"><span class="pre">pnl_calc_time</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.pnl_calc_time" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.price_function">
<span class="sig-name descname"><span class="pre">price_function</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.price_function" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.rules">
<span class="sig-name descname"><span class="pre">rules</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <a class="reference internal" href="#pyqstrat.account.Account" title="pyqstrat.account.Account"><code class="xref py py-class docutils literal notranslate"><span class="pre">Account</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a><span class="pre">]],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code><span class="pre">]],</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]]]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.rules" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_log_orders">
<span class="sig-name descname"><span class="pre">set_log_orders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_orders</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_log_orders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_log_orders" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_log_trades">
<span class="sig-name descname"><span class="pre">set_log_trades</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_trades</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_log_trades"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_log_trades" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_pnl_calc_time">
<span class="sig-name descname"><span class="pre">set_pnl_calc_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pnl_calc_time</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_pnl_calc_time"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_pnl_calc_time" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_price_function">
<span class="sig-name descname"><span class="pre">set_price_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_function</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_price_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_price_function" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_starting_equity">
<span class="sig-name descname"><span class="pre">set_starting_equity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">starting_equity</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_starting_equity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_starting_equity" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_strategy_context">
<span class="sig-name descname"><span class="pre">set_strategy_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_strategy_context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_strategy_context" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_timestamps">
<span class="sig-name descname"><span class="pre">set_timestamps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_timestamps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_timestamps" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.set_trade_lag">
<span class="sig-name descname"><span class="pre">set_trade_lag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trade_lag</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_builder.html#StrategyBuilder.set_trade_lag"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.set_trade_lag" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.signals">
<span class="sig-name descname"><span class="pre">signals</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">],</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">]],</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]],</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]]]]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.signals" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.starting_equity">
<span class="sig-name descname"><span class="pre">starting_equity</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.starting_equity" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.strategy_context">
<span class="sig-name descname"><span class="pre">strategy_context</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.strategy_context" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.timestamp_unit">
<span class="sig-name descname"><span class="pre">timestamp_unit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dtype</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.timestamp_unit" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.timestamps">
<span class="sig-name descname"><span class="pre">timestamps</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.timestamps" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_builder.StrategyBuilder.trade_lag">
<span class="sig-name descname"><span class="pre">trade_lag</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.strategy_builder.StrategyBuilder.trade_lag" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-pyqstrat.strategy_components">
<span id="pyqstrat-strategy-components-module"></span><h2>pyqstrat.strategy_components module<a class="headerlink" href="#module-pyqstrat.strategy_components" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">BracketOrderEntryRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_of_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_stop_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_position_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_entry_per_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_return_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#BracketOrderEntryRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A rule that generates orders with stops</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reason_code</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Reason for the orders created used for display</p></li>
<li><p><strong>price_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – A function that returns price given a contract and timestamp</p></li>
<li><p><strong>long</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – whether we want to go long or short</p></li>
<li><p><strong>percent_of_equity</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – How much to risk per trade as a percentage of current equity.
Used to calculate order qty so that if we get stopped out, we don’t lose
more than this amount. Of course if price gaps up or down rather than moving smoothly,
we may lose more.</p></li>
<li><p><strong>stop_return_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]]) – A function that gives us the distance between entry price and stop price</p></li>
<li><p><strong>min_stop_return</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – We will not enter if the stop_return is closer than this percent to the stop.
Otherwise, we get very large trade sizes</p></li>
<li><p><strong>max_position_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – An order should not result in a position that is greater than this percent
of the portfolio</p></li>
<li><p><strong>contract_filter</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <a class="reference internal" href="#pyqstrat.account.Account" title="pyqstrat.account.Account"><code class="xref py py-class docutils literal notranslate"><span class="pre">Account</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>], <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]]) – A function that takes similar arguments as a rule (with ContractGroup) replaced by
Contract but returns a list of contract names for each positive signal timestamp. For example,
for a strategy that trades 5000 stocks, you may want to construct a single signal and apply it
to different contracts at different times, rather than create 5000 signals that will call your rule
5000 times every time the signal is true.</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2023-01-05&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sig_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aapl_prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">100.1</span><span class="p">,</span> <span class="mf">100.2</span><span class="p">,</span> <span class="mf">100.3</span><span class="p">,</span> <span class="mf">100.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibm_prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">200.1</span><span class="p">,</span> <span class="mf">200.2</span><span class="p">,</span> <span class="mf">200.3</span><span class="p">,</span> <span class="mf">200.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aapl_stops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibm_stops</span><span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">price_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AAPL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">aapl_prices</span><span class="p">),</span> <span class="s1">&#39;IBM&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">ibm_prices</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stop_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AAPL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">aapl_stops</span><span class="p">),</span> <span class="s1">&#39;IBM&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">ibm_stops</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">price_func</span> <span class="o">=</span> <span class="n">PriceFuncArrayDict</span><span class="p">(</span><span class="n">price_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fr</span> <span class="o">=</span> <span class="n">BracketOrderEntryRule</span><span class="p">(</span><span class="s1">&#39;TEST_ENTRY&#39;</span><span class="p">,</span> <span class="n">price_func</span><span class="p">,</span> <span class="n">long</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default_cg</span> <span class="o">=</span> <span class="n">ContractGroup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default_cg</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default_cg</span><span class="o">.</span><span class="n">add_contract</span><span class="p">(</span><span class="n">Contract</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default_cg</span><span class="o">.</span><span class="n">add_contract</span><span class="p">(</span><span class="n">Contract</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="s1">&#39;IBM&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">equity</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1e6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orders</span> <span class="o">=</span> <span class="n">fr</span><span class="p">(</span><span class="n">default_cg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">SimpleNamespace</span><span class="p">(),</span> <span class="n">sig_values</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="p">[],</span> <span class="n">SimpleNamespace</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qty</span> <span class="o">==</span> <span class="o">-</span><span class="mi">998</span> <span class="ow">and</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">qty</span> <span class="o">==</span> <span class="o">-</span><span class="mi">499</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stop_return_func</span> <span class="o">=</span> <span class="n">PriceFuncArrayDict</span><span class="p">(</span><span class="n">stop_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fr</span> <span class="o">=</span> <span class="n">BracketOrderEntryRule</span><span class="p">(</span><span class="s1">&#39;TEST_ENTRY&#39;</span><span class="p">,</span> <span class="n">price_func</span><span class="p">,</span> <span class="n">long</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stop_return_func</span><span class="o">=</span><span class="n">stop_return_func</span><span class="p">,</span> <span class="n">min_stop_return</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orders</span> <span class="o">=</span> <span class="n">fr</span><span class="p">(</span><span class="n">default_cg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">SimpleNamespace</span><span class="p">(),</span> <span class="n">sig_values</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="p">[],</span> <span class="n">SimpleNamespace</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qty</span> <span class="o">==</span> <span class="mi">4985</span> <span class="ow">and</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">qty</span> <span class="o">==</span> <span class="mi">2496</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orders</span> <span class="o">=</span> <span class="n">fr</span><span class="p">(</span><span class="n">default_cg</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">SimpleNamespace</span><span class="p">(),</span> <span class="n">sig_values</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="p">[],</span> <span class="n">SimpleNamespace</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qty</span> <span class="o">==</span> <span class="mi">3326</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#BracketOrderEntryRule.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_of_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_stop_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_position_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_entry_per_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_return_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#BracketOrderEntryRule.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.contract_filter">
<span class="sig-name descname"><span class="pre">contract_filter</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.ContractGroup" title="pyqstrat.pq_types.ContractGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContractGroup</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <a class="reference internal" href="#pyqstrat.account.Account" title="pyqstrat.account.Account"><code class="xref py py-class docutils literal notranslate"><span class="pre">Account</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code><span class="pre">[</span><a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]]]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.contract_filter" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.long">
<span class="sig-name descname"><span class="pre">long</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.long" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.max_position_size">
<span class="sig-name descname"><span class="pre">max_position_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.max_position_size" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.min_stop_returnt">
<span class="sig-name descname"><span class="pre">min_stop_returnt</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.min_stop_returnt" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.percent_of_equity">
<span class="sig-name descname"><span class="pre">percent_of_equity</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.percent_of_equity" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.price_func">
<span class="sig-name descname"><span class="pre">price_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.price_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.single_entry_per_day">
<span class="sig-name descname"><span class="pre">single_entry_per_day</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.single_entry_per_day" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.BracketOrderEntryRule.stop_return_func">
<span class="sig-name descname"><span class="pre">stop_return_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.BracketOrderEntryRule.stop_return_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.ClosePositionExitRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">ClosePositionExitRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#ClosePositionExitRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.ClosePositionExitRule" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A rule to close out an open position</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reason_code</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the reason for closing out used for display purposes</p></li>
<li><p><strong>price_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – the function this rule uses to get market prices</p></li>
<li><p><strong>limit_increment</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – if not nan, we add or subtract this number from current market price (if selling or buying respectively)
and create a limit order</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.ClosePositionExitRule.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#ClosePositionExitRule.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.ClosePositionExitRule.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.ClosePositionExitRule.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#ClosePositionExitRule.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.ClosePositionExitRule.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.ClosePositionExitRule.limit_increment">
<span class="sig-name descname"><span class="pre">limit_increment</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.ClosePositionExitRule.limit_increment" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.ClosePositionExitRule.price_func">
<span class="sig-name descname"><span class="pre">price_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.ClosePositionExitRule.price_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.ClosePositionExitRule.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.ClosePositionExitRule.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">PercentOfEquityTradingRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equity_percent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocate_risk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PercentOfEquityTradingRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A rule that trades a percentage of equity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reason_code</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Reason for entering the order, used for display</p></li>
<li><p><strong>equity_percent</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Percentage of equity used to size order</p></li>
<li><p><strong>long</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Whether We want to go long or short</p></li>
<li><p><strong>allocate_risk</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, we divide the max risk by number of trades. Otherwise each trade will be alloated max risk</p></li>
<li><p><strong>limit_increment</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – If not nan, we add or subtract this number from current market price (if selling or buying respectively)
and create a limit order. If nan, we create market orders</p></li>
<li><p><strong>price_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – The function we use to get intraday prices</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PercentOfEquityTradingRule.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equity_percent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocate_risk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.allocate_risk">
<span class="sig-name descname"><span class="pre">allocate_risk</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.allocate_risk" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.equity_percent">
<span class="sig-name descname"><span class="pre">equity_percent</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.1</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.equity_percent" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.limit_increment">
<span class="sig-name descname"><span class="pre">limit_increment</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">nan</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.limit_increment" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.long">
<span class="sig-name descname"><span class="pre">long</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.long" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.price_func">
<span class="sig-name descname"><span class="pre">price_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.price_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PercentOfEquityTradingRule.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.PercentOfEquityTradingRule.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrayDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">PriceFuncArrayDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_previous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncArrayDict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrayDict" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="simple">
<dt>A function object with a signature of PriceFunctionType and takes a dictionary of</dt><dd><p>contract name -&gt; tuple of sorted timestamps and prices</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>price_dict</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]) – a dict with key=contract nane and value a tuple of timestamp and price arrays</p></li>
<li><p><strong>allow_previous</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – if set and we don’t find an exact match for the timestamp, use the
previous timestamp. Useful if you have a dict with keys containing dates instead of timestamps</p></li>
</ul>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2023-01-04&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">price_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AAPL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="s1">&#39;IBM&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">])}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pricefunc</span> <span class="o">=</span> <span class="n">PriceFuncArrayDict</span><span class="p">(</span><span class="n">price_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Contract</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aapl</span> <span class="o">=</span> <span class="n">Contract</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">pricefunc</span><span class="p">(</span><span class="n">aapl</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ibm</span> <span class="o">=</span> <span class="n">Contract</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;IBM&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basket</span> <span class="o">=</span> <span class="n">Contract</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;AAPL_IBM&#39;</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="p">[(</span><span class="n">aapl</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">ibm</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span><span class="p">(</span><span class="n">pricefunc</span><span class="p">(</span><span class="n">basket</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrayDict.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncArrayDict.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrayDict.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrayDict.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_previous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncArrayDict.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrayDict.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrayDict.allow_previous">
<span class="sig-name descname"><span class="pre">allow_previous</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrayDict.allow_previous" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrayDict.price_dict">
<span class="sig-name descname"><span class="pre">price_dict</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrayDict.price_dict" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrays">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">PriceFuncArrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_previous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncArrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrays" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A function object with a signature of PriceFunctionType. Takes three ndarrays
of symbols, timestamps and prices</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrays.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncArrays.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrays.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrays.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_previous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncArrays.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrays.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrays.allow_previous">
<span class="sig-name descname"><span class="pre">allow_previous</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrays.allow_previous" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncArrays.price_dict">
<span class="sig-name descname"><span class="pre">price_dict</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncArrays.price_dict" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">PriceFuncDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncDict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncDict" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A function object with a signature of PriceFunctionType and takes a dictionary of contract name -&gt; timestamp -&gt; price
&gt;&gt;&gt; timestamps = np.arange(np.datetime64(‘2023-01-01’), np.datetime64(‘2023-01-04’))
&gt;&gt;&gt; aapl_prices = [8, 9, 10]
&gt;&gt;&gt; ibm_prices = [20, 21, 22]
&gt;&gt;&gt; price_dict = {‘AAPL’: {}, ‘IBM’: {}}
&gt;&gt;&gt; for i, timestamp in enumerate(timestamps):
…    price_dict[‘AAPL’][timestamp] = aapl_prices[i]
…    price_dict[‘IBM’][timestamp] = ibm_prices[i]
&gt;&gt;&gt; pricefunc = PriceFuncDict(price_dict)
&gt;&gt;&gt; Contract.clear_cache()
&gt;&gt;&gt; aapl = Contract.create(‘AAPL’)
&gt;&gt;&gt; assert(pricefunc(aapl, timestamps, 2, None) == 10)
&gt;&gt;&gt; ibm = Contract.create(‘IBM’)
&gt;&gt;&gt; basket = Contract.create(‘AAPL_IBM’, components=[(aapl, 1), (ibm, -1)])
&gt;&gt;&gt; assert(pricefunc(basket, timestamps, 1, None) == -12)</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncDict.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncDict.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncDict.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncDict.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#PriceFuncDict.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncDict.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.PriceFuncDict.price_dict">
<span class="sig-name descname"><span class="pre">price_dict</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime64</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.PriceFuncDict.price_dict" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">SimpleMarketSimulator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slippage_pct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commission</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_rounding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trade_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#SimpleMarketSimulator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A function object with a signature of MarketSimulatorType.
It can take into account slippage and commission
&gt;&gt;&gt; ContractGroup.clear_cache()
&gt;&gt;&gt; Contract.clear_cache()
&gt;&gt;&gt; put_symbol, call_symbol = ‘SPX-P-3500-2023-01-19’, ‘SPX-C-4000-2023-01-19’
&gt;&gt;&gt; put_contract = Contract.create(put_symbol)
&gt;&gt;&gt; call_contract = Contract.create(call_symbol)
&gt;&gt;&gt; basket = Contract.create(‘test_contract’)
&gt;&gt;&gt; basket.components = [(put_contract, -1), (call_contract, 1)]
&gt;&gt;&gt; timestamp = np.datetime64(‘2023-01-03 14:35’)
&gt;&gt;&gt; price_func = PriceFuncDict({put_symbol: {timestamp: 4.8}, call_symbol: {timestamp: 3.5}})
&gt;&gt;&gt; order = MarketOrder(contract=basket, timestamp=timestamp, qty=10, reason_code=’TEST’)
&gt;&gt;&gt; sim = SimpleMarketSimulator(price_func=price_func, slippage_pct=0)
&gt;&gt;&gt; out = sim([order], 0, np.array([timestamp]), {}, {}, SimpleNamespace())
&gt;&gt;&gt; assert(len(out) == 1)
&gt;&gt;&gt; assert(math.isclose(out[0].price, -1.3))
&gt;&gt;&gt; assert(out[0].qty == 10)</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicators</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#SimpleMarketSimulator.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.__call__" title="Link to this definition">¶</a></dt>
<dd><p>TODO: code for stop orders</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slippage_pct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commission</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_rounding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trade_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#SimpleMarketSimulator.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>price_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – A function that we use to get the price to execute at</p></li>
<li><p><strong>slippage_pct</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Slippage per dollar transacted.
Meant to simulate the difference between bid/ask mid and execution price</p></li>
<li><p><strong>commission</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Fee paid to broker per trade</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.commission">
<span class="sig-name descname"><span class="pre">commission</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.commission" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.post_trade_func">
<span class="sig-name descname"><span class="pre">post_trade_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code><span class="pre">]]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.post_trade_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.price_func">
<span class="sig-name descname"><span class="pre">price_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.price_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.price_rounding">
<span class="sig-name descname"><span class="pre">price_rounding</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.price_rounding" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.SimpleMarketSimulator.slippage_pct">
<span class="sig-name descname"><span class="pre">slippage_pct</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.SimpleMarketSimulator.slippage_pct" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.StopReturnExitRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">StopReturnExitRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_return_func</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#StopReturnExitRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.StopReturnExitRule" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A rule that exits any given positions if a stop is hit.
You should set entry_price in the strategy context in the market simulator when you enter a position</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.StopReturnExitRule.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#StopReturnExitRule.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.StopReturnExitRule.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.StopReturnExitRule.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_return_func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.strategy_components.StopReturnExitRule.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.StopReturnExitRule.price_func">
<span class="sig-name descname"><span class="pre">price_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.StopReturnExitRule.price_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.StopReturnExitRule.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.StopReturnExitRule.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.StopReturnExitRule.stop_return_func">
<span class="sig-name descname"><span class="pre">stop_return_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.StopReturnExitRule.stop_return_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPCloseRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">VWAPCloseRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vwap_minutes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPCloseRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPCloseRule" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Rule to close out a position at vwap price
:type reason_code: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param reason_code: Reason_code: Reason for each order. For display purposes
:type vwap_minutes: <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>
:param vwap_minutes: How long the vwap period is. For example, a 5 minute vwap order will execute at 5 minute vwap</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPCloseRule.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPCloseRule.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPCloseRule.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPCloseRule.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vwap_minutes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPCloseRule.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPCloseRule.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPCloseRule.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPCloseRule.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPCloseRule.vwap_minutes">
<span class="sig-name descname"><span class="pre">vwap_minutes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPCloseRule.vwap_minutes" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">VWAPEntryRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vwap_minutes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_of_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_price_ind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_price_diff_pct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_entry_per_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPEntryRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A rule that generates VWAP orders</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>reason_code</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Reason for each order. For display purposes</p></li>
<li><p><strong>vwap_minutes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – How long the vwap period is. For example, a 5 minute vwap order will execute at 5 minute vwap</p></li>
<li><p><strong>market</strong> (<em>from when it is sent to the</em>) – </p></li>
<li><p><strong>price_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – A function that this rule uses to get market price at a given timestamp</p></li>
<li><p><strong>long</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Whether we want to go long or short</p></li>
<li><p><strong>percent_of_equity</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Order qty is calculated so that if the stop price is reached, we lose this amount</p></li>
<li><p><strong>stop_price_ind</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – Don’t enter if estimated entry price is
market price &lt;= stop price + min_price_diff_pct * market_price (for long orders) or the opposite for short orders</p></li>
<li><p><strong>min_price_diff_pct</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – See stop_price_ind</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPEntryRule.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Order" title="pyqstrat.pq_types.Order"><code class="xref py py-class docutils literal notranslate"><span class="pre">Order</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reason_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vwap_minutes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">price_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percent_of_equity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop_price_ind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_price_diff_pct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_entry_per_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPEntryRule.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.long">
<span class="sig-name descname"><span class="pre">long</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.long" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.min_price_diff_pct">
<span class="sig-name descname"><span class="pre">min_price_diff_pct</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.min_price_diff_pct" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.percent_of_equity">
<span class="sig-name descname"><span class="pre">percent_of_equity</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.percent_of_equity" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.price_func">
<span class="sig-name descname"><span class="pre">price_func</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code><span class="pre">[[</span><a class="reference internal" href="#pyqstrat.pq_types.Contract" title="pyqstrat.pq_types.Contract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contract</span></code></a><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code><span class="pre">,</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code><span class="pre">],</span> <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.price_func" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.reason_code">
<span class="sig-name descname"><span class="pre">reason_code</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.reason_code" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.single_entry_per_day">
<span class="sig-name descname"><span class="pre">single_entry_per_day</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.single_entry_per_day" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.stop_price_ind">
<span class="sig-name descname"><span class="pre">stop_price_ind</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.stop_price_ind" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPEntryRule.vwap_minutes">
<span class="sig-name descname"><span class="pre">vwap_minutes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPEntryRule.vwap_minutes" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPMarketSimulator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">VWAPMarketSimulator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_indicator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">volume_indicator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backup_price_indicator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPMarketSimulator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPMarketSimulator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A market simulator that simulates buying and selling at VWAP prices.
This works with VWAP orders and ignores all other order types
The order executes either:
a. After the vwap end time defined in the VWAP order
b. If marker price &lt;= vwap stop price defined in the VWAP order for buy orders
c. If market price &gt;= vwap stop price for sell orders</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPMarketSimulator.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orders</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicators</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPMarketSimulator.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPMarketSimulator.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<a class="reference internal" href="#pyqstrat.pq_types.Trade" title="pyqstrat.pq_types.Trade"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trade</span></code></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPMarketSimulator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_indicator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">volume_indicator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backup_price_indicator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VWAPMarketSimulator.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VWAPMarketSimulator.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>price_indicator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – An indicator that contains historical trade price per timestamp</p></li>
<li><p><strong>volume_indicator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – An indicator that contains volume per timestamp</p></li>
<li><p><strong>backup_price_indicator</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – Execution price to use if price or volume is missing</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPMarketSimulator.backup_price_indicator">
<span class="sig-name descname"><span class="pre">backup_price_indicator</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]</span></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPMarketSimulator.backup_price_indicator" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPMarketSimulator.price_indicator">
<span class="sig-name descname"><span class="pre">price_indicator</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPMarketSimulator.price_indicator" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VWAPMarketSimulator.volume_indicator">
<span class="sig-name descname"><span class="pre">volume_indicator</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VWAPMarketSimulator.volume_indicator" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorIndicator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">VectorIndicator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VectorIndicator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VectorIndicator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An indicator created from a vector
:type vector: <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>
:param vector: Vector with indicator values. Must be the same length as strategy timestamps</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorIndicator.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VectorIndicator.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VectorIndicator.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorIndicator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.strategy_components.VectorIndicator.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorIndicator.vector">
<span class="sig-name descname"><span class="pre">vector</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VectorIndicator.vector" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorSignal">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">VectorSignal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VectorSignal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VectorSignal" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A signal created from a vector that has boolean values
:type vector: <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>
:param vector: Vector with indicator values. Must be the same length as strategy timestamps</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorSignal.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contract_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indicator_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#VectorSignal.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.VectorSignal.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorSignal.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.strategy_components.VectorSignal.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.VectorSignal.vector">
<span class="sig-name descname"><span class="pre">vector</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></em><a class="headerlink" href="#pyqstrat.strategy_components.VectorSignal.vector" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.get_contract_price_from_array_dict">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">get_contract_price_from_array_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_previous</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#get_contract_price_from_array_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.get_contract_price_from_array_dict" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.strategy_components.get_contract_price_from_dict">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.strategy_components.</span></span><span class="sig-name descname"><span class="pre">get_contract_price_from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">price_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contract</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/strategy_components.html#get_contract_price_from_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.strategy_components.get_contract_price_from_dict" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat.interactive_plot">
<span id="pyqstrat-interactive-plot-module"></span><h2>pyqstrat.interactive_plot module<a class="headerlink" href="#module-pyqstrat.interactive_plot" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.InteractivePlot">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">InteractivePlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform_func=&lt;pyqstrat.interactive_plot.SimpleTransform</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_selection_widgets_func=&lt;function</span> <span class="pre">create_selection_dropdowns&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_filter_func=&lt;function</span> <span class="pre">simple_dimension_filter&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_filter_func=&lt;function</span> <span class="pre">simple_data_filter&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stat_func=&lt;pyqstrat.interactive_plot.MeanWithCI</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_func=&lt;pyqstrat.interactive_plot.LineGraphWithDetailDisplay</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display_form_func=&lt;function</span> <span class="pre">display_form&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#InteractivePlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.InteractivePlot" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Creates a multidimensional interactive plot off a dataframe.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.InteractivePlot.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform_func=&lt;pyqstrat.interactive_plot.SimpleTransform</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_selection_widgets_func=&lt;function</span> <span class="pre">create_selection_dropdowns&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_filter_func=&lt;function</span> <span class="pre">simple_dimension_filter&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_filter_func=&lt;function</span> <span class="pre">simple_data_filter&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stat_func=&lt;pyqstrat.interactive_plot.MeanWithCI</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_func=&lt;pyqstrat.interactive_plot.LineGraphWithDetailDisplay</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display_form_func=&lt;function</span> <span class="pre">display_form&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#InteractivePlot.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.InteractivePlot.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>) – The pandas dataframe to use for plotting</p></li>
<li><p><strong>labels</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – A dict where column names from the dataframe are mapped to user friendly labels. For any column names
not found as keys in this dict, we use the column name as the label. Default None</p></li>
<li><p><strong>dim_filter_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]], <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]) – A function that generates the values of a dimension based on other dimensions. For example, if
the user chooses “Put Option” in a put/call dropdown, the valid strikes could change in a Strike
dropdown that follows. Default simple_dimension_filter</p></li>
<li><p><strong>data_filter_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]], <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]) – A function that filters the data to plot. For example, if the user chooses “Put Option” in a put/call dropdown,
we could filter the dataframe to only include put options. Default simple_data_filter</p></li>
<li><p><strong>stat_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]]]]) – Once we have filtered the data, we may need to plot some statistics, such as mean and confidence intervals.
In this function, we compute these statistics. Default MeanWithCI()</p></li>
<li><p><strong>plot_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]]]], <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code>]]) – A function that plots the data.  This could also display detail data used to compute the statistics associated
with each data point.</p></li>
<li><p><strong>display_form_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – A function that displays the form given a list of plotly widgets (including the graph widget)</p></li>
<li><p><strong>debug</strong> – Dont clear forms if this is true so we can see print output</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.InteractivePlot.create_pivot">
<span class="sig-name descname"><span class="pre">create_pivot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xcol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zcol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimensions</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#InteractivePlot.create_pivot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.InteractivePlot.create_pivot" title="Link to this definition">¶</a></dt>
<dd><p>Create the initial pivot
:type xcol: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param xcol: Column name to use as the x axis in the DataFrame
:type ycol: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param ycol: Column name to use as the y axis in the DataFrame
:type zcol: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param zcol: Column name to use for z-values. Each zvalue can be used for a different trace within this plot. For example, a column
:param called “option_type” could contain the values “American”:
:param “European”:
:param “Bermudan” and we could plot the data for each type:
:param in a separate trace:
:type dimensions: <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]
:param dimensions: The column names used for filter dimensions. For example, we may want to filter by days to expiration and put/call
:param The key the column name and the value is the initial value for that column. For example:
:param in a:
:param dropdown for Put/Call we may want “Put” to be the initial value set in the dropdown.  Set to None if you:
:param don’t care what initial value is chosen.:</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.InteractivePlot.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">owner_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#InteractivePlot.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.InteractivePlot.update" title="Link to this definition">¶</a></dt>
<dd><p>Redraw the form using the values of all widgets above and including the one with index owner_idx.
If owner_idx is -1, we redraw everything.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">LineConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thickness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secondary_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lines+markers'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_detail</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#LineConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thickness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secondary_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lines+markers'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_detail</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig.color">
<span class="sig-name descname"><span class="pre">color</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig.color" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig.marker_mode">
<span class="sig-name descname"><span class="pre">marker_mode</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'lines+markers'</span></em><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig.marker_mode" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig.secondary_y">
<span class="sig-name descname"><span class="pre">secondary_y</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig.secondary_y" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig.show_detail">
<span class="sig-name descname"><span class="pre">show_detail</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig.show_detail" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineConfig.thickness">
<span class="sig-name descname"><span class="pre">thickness</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">nan</span></em><a class="headerlink" href="#pyqstrat.interactive_plot.LineConfig.thickness" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineGraphWithDetailDisplay">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">LineGraphWithDetailDisplay</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">display_detail_func=&lt;pyqstrat.interactive_plot.SimpleDetailTable</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line_configs={}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hovertemplate=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#LineGraphWithDetailDisplay"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.LineGraphWithDetailDisplay" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Draws line graphs and also includes a detail pane.
When you click on a point on the line graph, the detail pane shows the data used to compute that point.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineGraphWithDetailDisplay.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xaxis_title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yaxis_title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line_data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#LineGraphWithDetailDisplay.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.LineGraphWithDetailDisplay.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Draw the plot and also set it up so if you click on a point, we display the data used to compute that point.
:type line_data: <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]]]
:param line_data: The zvalue, plot data, and detail data for each line to draw. The plot data must have
:param x as the first column and y as the second column:
:rtype: <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code>]</p>
<blockquote>
<div><dl class="simple">
<dt>Return:</dt><dd><p>A list of widgets to draw.  In this case, a figure widget and a output widget which contains the detail display</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.LineGraphWithDetailDisplay.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">display_detail_func=&lt;pyqstrat.interactive_plot.SimpleDetailTable</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line_configs={}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hovertemplate=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#LineGraphWithDetailDisplay.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.LineGraphWithDetailDisplay.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>display_detail_func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – A function that displays the data on the detail pane. Default SimpleDetailTable</p></li>
<li><p><strong>line_configs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <a class="reference internal" href="#pyqstrat.interactive_plot.LineConfig" title="pyqstrat.interactive_plot.LineConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">LineConfig</span></code></a>]) – Configuration of each line. The key in this dict is the zvalue for that line.  Default {}</p></li>
<li><p><strong>title</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – Title of the graph. Default None</p></li>
<li><p><strong>hovertemplate</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – What to display when we hover over a point on the graph.  See plotly hovertemplate</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.MeanWithCI">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">MeanWithCI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mean_func=&lt;function</span> <span class="pre">nanmean&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ci_level=0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#MeanWithCI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.MeanWithCI" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Computes mean (or median) and optionally confidence intervals for plotting</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.MeanWithCI.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filtered_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xcol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zcol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#MeanWithCI.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.MeanWithCI.__call__" title="Link to this definition">¶</a></dt>
<dd><p>For each unique value of x and z, compute mean (and optionally ci) of y.
:rtype: <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]]]
:returns: x, y data for plotting lines of the mean of y versus x for each z and the data used to compute the mean</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.MeanWithCI.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mean_func=&lt;function</span> <span class="pre">nanmean&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ci_level=0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#MeanWithCI.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.MeanWithCI.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mean</strong> – The function to compute ci for</p></li>
<li><p><strong>ci_level</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Set to 0 for no confidence intervals, or the level you want.
For example, set to 95 to compute a 95% confidence interval. Default 0</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.SimpleDetailTable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">SimpleDetailTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">colnames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'{:.4g}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy_to_clipboard</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#SimpleDetailTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.SimpleDetailTable" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Displays a pandas DataFrame under a plot that contains the data used to compute a statistic of y for each x, y pair</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.SimpleDetailTable.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">detail_widget</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#SimpleDetailTable.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.SimpleDetailTable.__call__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>detail_widget</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code>) – The widget to display the data in</p></li>
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>) – The dataframe to display</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.SimpleDetailTable.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">colnames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">float_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'{:.4g}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy_to_clipboard</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#SimpleDetailTable.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.SimpleDetailTable.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>colnames</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – list of column names to display. If None we display all columns. Default None</p></li>
<li><p><strong>float_format</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Format for each floating point column. Default {:.4g}</p></li>
<li><p><strong>min_rows</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Do not truncate the display of the table before this many rows. Default 100</p></li>
<li><p><strong>copy_to_clipboard</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If set, we copy the dataframe to the clipboard. On linux, you must install xclip for this to work</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.SimpleTransform">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">SimpleTransform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#SimpleTransform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.SimpleTransform" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Initial transformation of data.  For example, you might add columns that are quantiles of other columns</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.SimpleTransform.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#SimpleTransform.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.SimpleTransform.__call__" title="Link to this definition">¶</a></dt>
<dd><p>Call self as a function.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.SimpleTransform.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#SimpleTransform.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.SimpleTransform.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.TestInteractivePlot">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">TestInteractivePlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">methodName</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'runTest'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#TestInteractivePlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.TestInteractivePlot" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.TestInteractivePlot.test_interactive_plot">
<span class="sig-name descname"><span class="pre">test_interactive_plot</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#TestInteractivePlot.test_interactive_plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.TestInteractivePlot.test_interactive_plot" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.TestInteractivePlot.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#TestInteractivePlot.transform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.TestInteractivePlot.transform" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.create_selection_dropdowns">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">create_selection_dropdowns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dims</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_form_func</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#create_selection_dropdowns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.create_selection_dropdowns" title="Link to this definition">¶</a></dt>
<dd><p>Create a list of selection widgets</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.display_form">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">display_form</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">form_widgets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#display_form"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.display_form" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.foo">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">foo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#foo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.foo" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.on_widgets_updated">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">on_widgets_updated</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">change</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_form_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection_widgets</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#on_widgets_updated"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.on_widgets_updated" title="Link to this definition">¶</a></dt>
<dd><p>Callback called by plotly when widgets are updated by the user.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.percentile_buckets">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">percentile_buckets</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#percentile_buckets"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.percentile_buckets" title="Link to this definition">¶</a></dt>
<dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">:rtype: :py:class:`~numpy.ndarray`</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">percentile_buckets</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.simple_data_filter">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">simple_data_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selected_values</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#simple_data_filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.simple_data_filter" title="Link to this definition">¶</a></dt>
<dd><p>Filters a dataframe based on the selected values</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyqstrat.interactive_plot.simple_dimension_filter">
<span class="sig-prename descclassname"><span class="pre">pyqstrat.interactive_plot.</span></span><span class="sig-name descname"><span class="pre">simple_dimension_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selected_values</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pyqstrat/interactive_plot.html#simple_dimension_filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyqstrat.interactive_plot.simple_dimension_filter" title="Link to this definition">¶</a></dt>
<dd><p>Produces a list to put into a dropdown for selecting a dimension value</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pyqstrat">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pyqstrat" title="Link to this heading">¶</a></h2>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pyqstrat</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">pyqstrat</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">pyqstrat package</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">pyqstrat</a><ul>
      <li>Previous: <a href="modules.html" title="previous chapter">pyqstrat</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Sal Abbasi.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/pyqstrat.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>